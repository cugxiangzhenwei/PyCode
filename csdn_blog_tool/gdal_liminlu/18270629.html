
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
     
    <html xmlns="http://www.w3.org/1999/xhtml">
    
<head>  

            <link rel="canonical" href="http://blog.csdn.net/liminlu0314/article/details/18270629"/> 
 <meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />
       
    <title>扩展GDAL，支持CNSDTF格式（一） - GDAL专栏
        - 博客频道 - CSDN.NET</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="扩展GDAL，支持CNSDTF格式（一）一、&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;简介本文主要根据《中华人民共和国国家标准GB/T17798-2007——地理空间数据交换格式（Geospatialdata transfer format）》（http://www.bzxz.net/bzxz/129804.html）中定义的格网数据和矢量数据格式内容，对GDAL库进行扩充，使之可以直接打开这两种格式。此外GDAL格式扩展" />

    <meta name="keywords" content="" />

   
    <script src="http://static.blog.csdn.net/scripts/blog_static_head.min.js" type="text/javascript"></script>

    
        <!--new top-->
                      <!--new top-->
    
      <!-- ad begin -->
         
    <!-- ad end-->

    <link rel="Stylesheet" type="text/css" href="http://static.blog.csdn.net/skin/default/css/style.css?v=1.1" />

    

    <link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="/liminlu0314/rss/list" />
    <link rel="shortcut icon" href="http://c.csdnimg.cn/public/favicon.ico" />
    <link type="text/css" rel="stylesheet" href="http://static.blog.csdn.net/scripts/SyntaxHighlighter/styles/nobg.css" />
 




    <link href="http://c.csdnimg.cn/blog/csdn_public_blog_detail.min.css" type="text/css" rel="stylesheet" />
     
         <link rel="stylesheet" href="http://static.blog.csdn.net/css/csdn_blog_detail.min.css" />

     <script src="http://c.csdnimg.cn/rabbit/tracking-ad/fuckadblock.js" type="text/javascript" charset="utf-8"></script>
         <script src="http://c.csdnimg.cn/rabbit/tracking-ad/block.js?v=20170531.001" type="text/javascript" charset="utf-8"></script>


    <!-- 请置于所有广告位代码之前 --> 
            <script src="http://dup.baidustatic.com/js/ds.js"></script>

</head>


<body>
       



    <!-- 广告位开始 -->
        
    <!-- 广告位结束 -->

    
   
      <!--new top-->
    <script id="toolbar-tpl-scriptId" fixed="true" prod="blog" skin="black" src="http://c.csdnimg.cn/public/common/toolbar/js/html.js" type="text/javascript"></script>
     <!--new top-->
    <div id="container">
        <div id="header">
    <div class="header">
        <div id="blog_title">
            <h2>
                <a href="http://blog.csdn.net/liminlu0314">GDAL专栏</a></h2>
            <h3>Focusing on Remote Sensing Algorithms and Geospatial Applications. 承接各种遥感图像处理算法程序的编写.</h3>
            <div class="clear">
            </div>
        </div>
        <div class="clear">
        </div>
        
     
    </div>
</div>
<div id="navigator">
    <div class="navigator_bg">
    </div>
    <div class="navigator">
        <ul>           
                <li id="btnContents"><a href="http://blog.csdn.net/liminlu0314?viewmode=contents"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_mulu'])">
                    <img src="http://static.blog.csdn.net/images/ico_list.gif">目录视图</span></a></li>
                <li id="btnView"><a href="http://blog.csdn.net/liminlu0314?viewmode=list"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_zhaiyao'])">
                    <img src="http://static.blog.csdn.net/images/ico_summary.gif">摘要视图</span></a></li>
                <li id="btnRss"><a href="http://blog.csdn.net/liminlu0314/rss/list"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_RSS'])">
                    <img src="http://static.blog.csdn.net/images/ico_rss.gif">订阅</span></a></li>                
            

            </ul>
    </div>
</div>
<script type="text/javascript">
    var username = "liminlu0314";
    var _blogger = username;
    var blog_address = "http://blog.csdn.net/liminlu0314";
    var static_host = "http://static.blog.csdn.net";
    var currentUserName = "";  
</script>

        <div id="body">
            <div id="main">
                <div class="main">
                        <div class="ad_class">
<div class="notice tracking-ad" data-mod='popu_3' > 


<a href="http://bss.csdn.net/m/topic/community_IoT/index">
<font color=red><strong>【CSDN 技术主题月】物联网全栈开发</strong></font></a>

&nbsp;&nbsp;&nbsp;&nbsp

<a href=" http://blog.csdn.net/broadview2006/article/details/72901572">
<font color=blue><strong>【评论送书】每周荐书：JVM、Nginx、小程序</strong></font></a>
&nbsp;&nbsp;&nbsp;&nbsp


<a href="http://blog.csdn.net/blogdevteam/article/details/72903038">
<font color=red><strong>CSDN日报20170607 ——《别混淆你想要什么和能否实现》</strong></font></a>


</div>                        </div>
                        



  






<script   type="text/javascript" src="http://static.blog.csdn.net/scripts/category.js"></script>

  <script type="text/ecmascript">
      window.quickReplyflag = true;
           
            var isBole = false;
            
      
      var fasrc="http://my.csdn.net/my/favorite/miniadd?t=%e6%89%a9%e5%b1%95GDAL%ef%bc%8c%e6%94%af%e6%8c%81CNSDTF%e6%a0%bc%e5%bc%8f%ef%bc%88%e4%b8%80%ef%bc%89&u=http://blog.csdn.net/liminlu0314/article/details/18270629"

    </script>
<div id="article_details" class="details">
    <div class="article_title">   
         <span class="ico ico_type_Original"></span>


    <h1>
        <span class="link_title"><a href="/liminlu0314/article/details/18270629">
        扩展GDAL，支持CNSDTF格式（一）            
        </a></span>
    </h1>
</div>

   

        <div class="article_manage clearfix">
        <div class="article_r">
            <span class="link_postdate">2014-01-14 19:48</span>
            <span class="link_view" title="阅读次数">2825人阅读</span>
            <span class="link_comments" title="评论次数"> <a href="#comments" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_pinglun'])">评论</a>(2)</span>
            <span class="link_collect tracking-ad" data-mod="popu_171"> <a href="javascript:void(0);" onclick="javascript:collectArticle('%e6%89%a9%e5%b1%95GDAL%ef%bc%8c%e6%94%af%e6%8c%81CNSDTF%e6%a0%bc%e5%bc%8f%ef%bc%88%e4%b8%80%ef%bc%89','18270629');return false;" title="收藏">收藏</a></span>
             <span class="link_report"> <a href="#report" onclick="javascript:report(18270629,2);return false;" title="举报">举报</a></span>

        </div>
    </div>
    <div class="embody"  style="display:none" id="embody">
        <span class="embody_t">本文章已收录于：</span>
        <div class="embody_c" id="lib" value="{&quot;err&quot;:0,&quot;msg&quot;:&quot;ok&quot;,&quot;data&quot;:[]}"></div>
    </div>
    <style type="text/css">        
            .embody{
                padding:10px 10px 10px;
                margin:0 -20px;
                border-bottom:solid 1px #ededed;                
            }
            .embody_b{
                margin:0 ;
                padding:10px 0;
            }
            .embody .embody_t,.embody .embody_c{
                display: inline-block;
                margin-right:10px;
            }
            .embody_t{
                font-size: 12px;
                color:#999;
            }
            .embody_c{
                font-size: 12px;
            }
            .embody_c img,.embody_c em{
                display: inline-block;
                vertical-align: middle;               
            }
             .embody_c img{               
                width:30px;
                height:30px;
            }
            .embody_c em{
                margin: 0 20px 0 10px;
                color:#333;
                font-style: normal;
            }
    </style>
    <script  type="text/javascript">
        $(function () {
            try
            {
                var lib = eval("("+$("#lib").attr("value")+")");
                var html = "";
                if (lib.err == 0) {
                    $.each(lib.data, function (i) {
                        var obj = lib.data[i];
                        //html += '<img src="' + obj.logo + '"/>' + obj.name + "&nbsp;&nbsp;";
                        html += ' <a href="' + obj.url + '" target="_blank">';
                        html += ' <img src="' + obj.logo + '">';
                        html += ' <em><b>' + obj.name + '</b></em>';
                        html += ' </a>';
                    });
                    if (html != "") {
                        setTimeout(function () {
                            $("#lib").html(html);                      
                            $("#embody").show();
                        }, 100);
                    }
                }      
            } catch (err)
            { }
            
        });
    </script>
      <div class="category clearfix">
        <div class="category_l">
           <img src="http://static.blog.csdn.net/images/category_icon.jpg">
            <span>分类：</span>
        </div>
        <div class="category_r">
                    <label  onclick="GetCategoryArticles('777646','liminlu0314','top','18270629');">
                        <span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_fenlei']);">GDAL<em>（119）</em></span>
                      <img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle _down.jpg" style="display:inline;">
                      <img class="arrow-up" src="http://static.blog.csdn.net/images/arrow_triangle_up.jpg" style="display:none;">
                        <div class="subItem">
                            <div class="subItem_t"><a  href="http://blog.csdn.net/liminlu0314/article/category/777646"  target="_blank">作者同类文章</a><i class="J_close">X</i></div>
                            <ul class="subItem_l" id="top_777646">                            
                            </ul>
                        </div>
                    </label>                    
                    <label  onclick="GetCategoryArticles('777642','liminlu0314','top','18270629');">
                        <span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_fenlei']);">C++编程技术<em>（59）</em></span>
                      <img class="arrow-down" src="http://static.blog.csdn.net/images/arrow_triangle _down.jpg" style="display:inline;">
                      <img class="arrow-up" src="http://static.blog.csdn.net/images/arrow_triangle_up.jpg" style="display:none;">
                        <div class="subItem">
                            <div class="subItem_t"><a  href="http://blog.csdn.net/liminlu0314/article/category/777642"  target="_blank">作者同类文章</a><i class="J_close">X</i></div>
                            <ul class="subItem_l" id="top_777642">                            
                            </ul>
                        </div>
                    </label>                    
        </div>
    </div>
        <div   class="bog_copyright">         
            <p  class="copyright_p" >版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
        </div>

  

  
  
     


<div id="article_content" class="article_content tracking-ad" data-mod=popu_307  data-dsm = "post" >
<p align="center"><span style="font-size:14px;color:#000099;">扩展GDAL，支持CNSDTF格式（一）</span></p><p align="left"><span style="font-size:14px;color:#000099;"><strong>一、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;简介</strong></span></p><p align="left"><span style="font-size:14px;color:#000099;">本文主要根据《中华人民共和国国家标准GB/T17798-2007——地理空间数据交换格式（Geospatialdata transfer format）》（<a target=_blank href="http://www.bzxz.net/bzxz/129804.html">http://www.bzxz.net/bzxz/129804.html</a>）中定义的格网数据和矢量数据格式内容，对GDAL库进行扩充，使之可以直接打开这两种格式。</span></p><p align="left"><span style="font-size:14px;color:#000099;">此外GDAL格式扩展就参考GDAL官方文档中的扩展方式。网址为：<a target=_blank href="http://www.gdal.org/gdal_drivertut.html">www.gdal.org/gdal_drivertut.html</a>。</span></p><p align="left"><span style="font-size:14px;color:#000099;"><strong>二、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;软件和数据</strong></span></p><p align="left"><span style="font-size:14px;color:#000099;">编写代码的软件使用Visual Studio2008 SP1，使用其他的记事本软件应该都可以，此外还需要一个编译器，来编译GDAL，用来检验写的代码的正确性。</span></p><p align="left"><span style="font-size:14px;color:#000099;">数据是按照国标GB/T17798-2007中的示例数据自己写的一个测试数据。栅格数据内容如下，矢量数据比较复杂，后面单独再说，下面先介绍栅格数据。</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_1_4256807"  name="code" class="plain">DataMark:CNSDTF-DEM
Version:1.0
Alpha:0.0
Compress:0
X0:458312.500
Y0:3458762.500
DX:12.500
DY:12.500
Row:10
Col:30
ValueType:Integer
Hzoom:100
XYUnit:M
ZUnit:M
CoordinateSystemType:P
Spheroid:西安(1980),6378.140,298.257
Projection:高斯-克吕格
Parameters:117,0,,,,1,500000,0,3,
 
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
2387987 1564 1574 785 854 587 747 454 7844
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354
100200 355 45 124 4548 147 145 1454 354</pre><div style="text-align: center;"><img src="http://img.blog.csdn.net/20140114193920281?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGltaW5sdTAzMTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /><br /></div><br /></p><p align="left"></p><p align="left"><span style="font-size:14px;color:#000099;"><strong>三、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编写源码</strong></span></p><p align="left"><span style="font-size:14px;color:#000099;">首先按照GDAL官网中的说明，我们要实现一个从GDALDataset类派生的一个子类CNSDTFDataset，该类的定义如下：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_2_5925247"  name="code" class="cpp">/************************************************************************/
/*==================================================================== */
/*                             CNSDTFDataset                          */
/*==================================================================== */
/************************************************************************/
 
classCNSDTFRasterBand;
 
classCPL_DLL CNSDTFDataset : public GDALPamDataset
{
      friend class CNSDTFRasterBand;
 
      VSILFILE  *fp;
 
      char       **papszPrj;
      CPLString  osPrjFilename;
      char       *pszProjection;
 
      // DataMark Version Compress Alpha
      CPLString    osDataMark;
      CPLString    osDataVersion;
      GBool      bIsCompress;
      double     adfAlphaValue;
      CPLString  osValueType;
      int              nHZoom;
      CPLString  osUnitType;
 
      unsigned char achReadBuf[256];
      GUIntBig   nBufferOffset;
      int        nOffsetInBuffer;
 
      char       Getc();
      GUIntBig   Tell();
      int        Seek( GUIntBig nOffset );
 
protected:
      GDALDataType eDataType;
      double     adfGeoTransform[6];
      int        bNoDataSet;
      double     dfNoDataValue;
      double     dfMin;
      double     dfMax;
 
      int ParseHeader(const char* pszHeader);
 
public:
      CNSDTFDataset();
      ~CNSDTFDataset();
 
      virtual char **GetFileList(void);
 
      static GDALDataset *Open( GDALOpenInfo *poOpenInfo);
      static int          Identify( GDALOpenInfo * poOpenInfo);
      static GDALDataset *CreateCopy( const char* pszFilename,
           GDALDataset *poSrcDS, int bStrict,char ** papszOptions,
           GDALProgressFunc pfnProgress, void *pProgressData );
 
      virtual CPLErr GetGeoTransform( double *padfTransform);
      virtual const char*GetProjectionRef(void);
};</pre></p><p align="left"><span style="font-size:14px;color:#000099;">下面是该类的实现，没有实现Create方法，只实现了CreateCopy方式，以后有时间把Create方法加上。</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_3_7735390"  name="code" class="cpp">/************************************************************************/
/*                           CNSDTFDataset()                          */
/************************************************************************/
 
CNSDTFDataset::CNSDTFDataset()
{
      papszPrj = NULL;
      pszProjection = CPLStrdup(&quot;&quot;);
      fp = NULL;
      eDataType = GDT_Int32;
      bNoDataSet = FALSE;
      dfNoDataValue = -99999.0;
 
      adfGeoTransform[0] = 0.0;
      adfGeoTransform[1] = 1.0;
      adfGeoTransform[2] = 0.0;
      adfGeoTransform[3] = 0.0;
      adfGeoTransform[4] = 0.0;
      adfGeoTransform[5] = 1.0;
 
      nOffsetInBuffer = 256;
      nBufferOffset = 0;
 
      osDataMark = &quot;CNSDTF-RAS&quot;;
      osDataVersion = &quot;GB/T17798-2007&quot;;
      bIsCompress = FALSE;
      adfAlphaValue = 0.0;
      osValueType = &quot;Integer&quot;;
      nHZoom = 1;
      dfMin = 0.0;
    dfMax = 0.0;
}
 
/************************************************************************/
/*                          ~CNSDTFDataset()                           */
/************************************************************************/
 
CNSDTFDataset::~CNSDTFDataset()
 
{
      FlushCache();
 
      if( fp != NULL )
           VSIFCloseL( fp );
 
      CPLFree( pszProjection );
      CSLDestroy( papszPrj );
}
 
/************************************************************************/
/*                                Tell()                                */
/************************************************************************/
 
GUIntBigCNSDTFDataset::Tell()
 
{
      return nBufferOffset + nOffsetInBuffer;
}
 
/************************************************************************/
/*                                Seek()                                */
/************************************************************************/
 
intCNSDTFDataset::Seek( GUIntBig nNewOffset )
 
{
      nOffsetInBuffer = sizeof(achReadBuf);
      return VSIFSeekL( fp, nNewOffset, SEEK_SET);
}
 
/************************************************************************/
/*                                Getc()                                */
/*                                                                     */
/*      Read a single character from the inputfile (efficiently we     */
/*      hope).                                                          */
/************************************************************************/
 
charCNSDTFDataset::Getc()
 
{
      if( nOffsetInBuffer &lt; (int)sizeof(achReadBuf) )
           return achReadBuf[nOffsetInBuffer++];
 
      nBufferOffset = VSIFTellL( fp );
      int nRead = VSIFReadL( achReadBuf, 1,sizeof(achReadBuf), fp );
      unsigned int i;
      for(i=nRead;i&lt;sizeof(achReadBuf);i++)
           achReadBuf[i] = '\0';
 
      nOffsetInBuffer = 0;
 
      return achReadBuf[nOffsetInBuffer++];
}
 
/************************************************************************/
/*                            GetFileList()                             */
/************************************************************************/
 
char**CNSDTFDataset::GetFileList()
 
{
      char **papszFileList =GDALPamDataset::GetFileList();
 
      if( papszPrj != NULL )
           papszFileList = CSLAddString(papszFileList, osPrjFilename );
 
      return papszFileList;
}
 
/************************************************************************/
/*                            Identify()                                */
/************************************************************************/
 
intCNSDTFDataset::Identify( GDALOpenInfo * poOpenInfo )
 
{
      /*-------------------------------------------------------------------- */
      /*     Does this look like an CNSDTF grid file?                        */
      /*-------------------------------------------------------------------- */
      if( poOpenInfo-&gt;nHeaderBytes &lt; 40
           || !( EQUALN((const char *) poOpenInfo-&gt;pabyHeader,&quot;DataMark&quot;,8)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;Version&quot;,7) ||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;Alpha&quot;,5)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;Compress&quot;,7)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;X0&quot;,2)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;Y0&quot;,2)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;DX&quot;,2)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;DY&quot;,2)||
           EQUALN((const char *) poOpenInfo-&gt;pabyHeader,&quot;Row&quot;,3)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;Col&quot;,3)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;ValueType&quot;,9)||
           EQUALN((const char *)poOpenInfo-&gt;pabyHeader,&quot;HZoom&quot;,5)) )
           return FALSE;
 
      char** papszTokens = CSLTokenizeString2((const char *) poOpenInfo-&gt;pabyHeader, &quot; \n\r\t&quot; , 0 );
      int nTokens = CSLCount(papszTokens);
      if (nTokens &lt;11)      //the header at (the) least 11 lines
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      if( poOpenInfo-&gt;nHeaderBytes &lt; 40 ||
           !( EQUALN(papszTokens[0],&quot;DataMark:CNSDTF-DEM&quot;, 19) ||
           EQUALN(papszTokens[0],&quot;DataMark:CNSDTF-RAS&quot;, 19) ||
           EQUALN(papszTokens[0],&quot;DataMark:CSDTF-DEM&quot;, 18) ||
           EQUALN(papszTokens[0],&quot;DataMark:CSDTF-RAS&quot;, 18))
           )
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      CSLDestroy( papszTokens );
      return TRUE;
}
 
/************************************************************************/
/*                                Open()                                */
/************************************************************************/
 
GDALDataset*CNSDTFDataset::Open( GDALOpenInfo * poOpenInfo )
{
      if (!Identify(poOpenInfo))
           return NULL;
 
      int i = 0;
 
      /*-------------------------------------------------------------------- */
      /*     Create a corresponding GDALDataset.                             */
      /*-------------------------------------------------------------------- */
      CNSDTFDataset         *poDS;
      poDS = new CNSDTFDataset();
 
      /* --------------------------------------------------------------------*/
      /*     Parse the header.                                              */
      /*-------------------------------------------------------------------- */
      if (!poDS-&gt;ParseHeader((const char *)poOpenInfo-&gt;pabyHeader))
      {
           delete poDS;
           return NULL;
      }
 
      /*-------------------------------------------------------------------- */
      /*     Open file with large file API.                                  */
      /*-------------------------------------------------------------------- */
 
      poDS-&gt;fp = VSIFOpenL(poOpenInfo-&gt;pszFilename, &quot;r&quot; );
      if( poDS-&gt;fp == NULL )
      {
           CPLError( CE_Failure,CPLE_OpenFailed,
                 &quot;VSIFOpenL(%s) failedunexpectedly.&quot;,
                 poOpenInfo-&gt;pszFilename );
           delete poDS;
           return NULL;
      }
 
      /*-------------------------------------------------------------------- */
      /*     Find the start of real data.                                    */
      /*-------------------------------------------------------------------- */
      int        nStartOfData;
 
      for (i=0; TRUE; i++)
      {
           char cChar =poOpenInfo-&gt;pabyHeader[i];
           if( cChar == '\0' )
           {
                 CPLError( CE_Failure,CPLE_AppDefined,
                      &quot;Couldn't find datavalues in CNSDTF Grid file.\n&quot; );
                 delete poDS;
                 return NULL;
           }
 
           if (cChar == '\r' || cChar == '\n')
           {
                 char cNext =poOpenInfo-&gt;pabyHeader[i+1];
                 if(isalpha(cNext) ||isalpha(poOpenInfo-&gt;pabyHeader[i+2]))
                      continue;
 
                 if ((cNext &gt;= '0' &amp;&amp;cNext &lt;='9')
                      || cNext=='-'
                      || cNext=='.' )
                 {
                      nStartOfData = i+1;
                      /* Beginning of real datafound. */
                      break;
                 }
           }
      }
 
      /*-------------------------------------------------------------------- */
      /*     Recognize the type of data.                                                      */
      /* --------------------------------------------------------------------*/
      CPLAssert( NULL != poDS-&gt;fp );
 
      /*-------------------------------------------------------------------- */
      /*     Create band information objects.                                */
      /* --------------------------------------------------------------------*/
      CNSDTFRasterBand* band = newCNSDTFRasterBand( poDS, nStartOfData );
      poDS-&gt;SetBand( 1, band );
      if (band-&gt;panLineOffset == NULL)
      {
           delete poDS;
           return NULL;
      }
 
      /*-------------------------------------------------------------------- */
      /*     Parse the SRS.                                                 */
      /*-------------------------------------------------------------------- */
      CPLString strProjection = ParseSpatialReference((constchar *) poOpenInfo-&gt;pabyHeader);
      if (strProjection != &quot;&quot;)
      {
           CPLFree( poDS-&gt;pszProjection );
           poDS-&gt;pszProjection =CPLStrdup(strProjection.c_str());
      }
     
      if (EQUAL(poDS-&gt;pszProjection,&quot;&quot;))
      {
           /* --------------------------------------------------------------------*/
           /*      Try to read projection file.                                    */
           /*-------------------------------------------------------------------- */
           char        *pszDirname, *pszBasename;
           VSIStatBufL   sStatBuf;
 
           pszDirname =CPLStrdup(CPLGetPath(poOpenInfo-&gt;pszFilename));
           pszBasename =CPLStrdup(CPLGetBasename(poOpenInfo-&gt;pszFilename));
 
           poDS-&gt;osPrjFilename =CPLFormFilename( pszDirname, pszBasename, &quot;prj&quot; );
           int nRet = VSIStatL(poDS-&gt;osPrjFilename, &amp;sStatBuf );
 
           if( nRet != 0 &amp;&amp;VSIIsCaseSensitiveFS(poDS-&gt;osPrjFilename) )
           {
                 poDS-&gt;osPrjFilename =CPLFormFilename( pszDirname, pszBasename, &quot;PRJ&quot; );
                 nRet = VSIStatL(poDS-&gt;osPrjFilename, &amp;sStatBuf );
            }
 
           if( nRet == 0 )
           {
                 OGRSpatialReference     oSRS;
 
                 poDS-&gt;papszPrj = CSLLoad(poDS-&gt;osPrjFilename );
 
                 CPLDebug( &quot;CNSDTFGrid&quot;, &quot;Loaded SRS from %s&quot;,
                      poDS-&gt;osPrjFilename.c_str());
 
                 if( oSRS.importFromESRI(poDS-&gt;papszPrj ) == OGRERR_NONE )
                 {
                      // If geographic valuesare in seconds, we must transform.
                      // Is there a code forminutes too?
                      if( oSRS.IsGeographic()
                            &amp;&amp;EQUAL(OSR_GDS( poDS-&gt;papszPrj, &quot;Units&quot;, &quot;&quot;),&quot;DS&quot;) )
                      {
                            poDS-&gt;adfGeoTransform[0]/= 3600.0;
                            poDS-&gt;adfGeoTransform[1] /= 3600.0;
                            poDS-&gt;adfGeoTransform[2]/= 3600.0;
                            poDS-&gt;adfGeoTransform[3]/= 3600.0;
                            poDS-&gt;adfGeoTransform[4]/= 3600.0;
                            poDS-&gt;adfGeoTransform[5]/= 3600.0;
                      }
 
                      CPLFree(poDS-&gt;pszProjection );
                      oSRS.exportToWkt(&amp;(poDS-&gt;pszProjection) );
                 }
           }
 
           CPLFree( pszDirname );
           CPLFree( pszBasename );    
      }
 
      /*-------------------------------------------------------------------- */
      /*     Initialize any PAM information.                                 */
      /*-------------------------------------------------------------------- */
      poDS-&gt;SetDescription(poOpenInfo-&gt;pszFilename );
      poDS-&gt;TryLoadXML();
 
      /*-------------------------------------------------------------------- */
      /*     Check for external overviews.                                   */
      /*-------------------------------------------------------------------- */
      poDS-&gt;oOvManager.Initialize( poDS,poOpenInfo-&gt;pszFilename, poOpenInfo-&gt;papszSiblingFiles );
 
      return( poDS );
}
 
/************************************************************************/
/*                          ParseHeader()                               */
/************************************************************************/
 
intCNSDTFDataset::ParseHeader(const char* pszHeader)
{
      int i, j;
      char** papszTokens = CSLTokenizeString2(pszHeader,  &quot; \n\r\t:：&quot; , 0 );
      int nTokens = CSLCount(papszTokens);
 
      if ( (i = CSLFindString( papszTokens,&quot;DataMark&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
      osDataMark = papszTokens[i + 1];
 
      if ( (i = CSLFindString( papszTokens,&quot;Version&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
      osDataVersion = papszTokens[i + 1];
 
      if ( (i = CSLFindString( papszTokens,&quot;Alpha&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
      adfAlphaValue = CPLAtofM(papszTokens[i +1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;Compress&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
      bIsCompress = atoi(papszTokens[i + 1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;Hzoom&quot; )) &lt; 0 ||
           i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
      nHZoom = atoi(papszTokens[i + 1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;Col&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      nRasterXSize = atoi(papszTokens[i + 1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;Row&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      nRasterYSize = atoi(papszTokens[i + 1]);
 
      if(!GDALCheckDatasetDimensions(nRasterXSize, nRasterYSize))
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      double dfCellDX = 0;
      double dfCellDY = 0;
      if ( (i = CSLFindString( papszTokens,&quot;CELLSIZE&quot; )) &lt; 0 )
      {
           int iDX, iDY;
           if( (iDX =CSLFindString(papszTokens,&quot;DX&quot;)) &lt; 0
                 || (iDY =CSLFindString(papszTokens,&quot;DY&quot;)) &lt; 0
                 || iDX+1 &gt;= nTokens
                 || iDY+1 &gt;= nTokens)
           {
                 CSLDestroy( papszTokens );
                 return FALSE;
           }
 
           dfCellDX = CPLAtofM(papszTokens[iDX+1] );
           dfCellDY = CPLAtofM(papszTokens[iDY+1] );
      }
      else
      {
           if (i + 1 &gt;= nTokens)
           {
                 CSLDestroy( papszTokens );
                 return FALSE;
           }
           dfCellDX = dfCellDY = CPLAtofM(papszTokens[i + 1] );
      }
 
      if ((i = CSLFindString( papszTokens,&quot;X0&quot; )) &gt;= 0 &amp;&amp;
           (j = CSLFindString( papszTokens,&quot;Y0&quot; )) &gt;= 0 &amp;&amp;
           i + 1 &lt; nTokens &amp;&amp; j + 1&lt; nTokens)
      {
           adfGeoTransform[0] = CPLAtofM(papszTokens[i + 1] );
           adfGeoTransform[1] = dfCellDX;
           adfGeoTransform[2] = 0.0;
           adfGeoTransform[3] = CPLAtofM(papszTokens[j + 1] );
           adfGeoTransform[4] = 0.0;
           adfGeoTransform[5] = - dfCellDY;
      }
      else
      {
           adfGeoTransform[0] = 0.0;
           adfGeoTransform[1] = dfCellDX;
           adfGeoTransform[2] = 0.0;
           adfGeoTransform[3] = 0.0;
           adfGeoTransform[4] = 0.0;
           adfGeoTransform[5] = - dfCellDY;
      }
 
      if ( (i = CSLFindString( papszTokens,&quot;ValueType&quot; )) &lt; 0 || i + 1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           return FALSE;
      }
 
      osValueType = papszTokens[i + 1];
      if (EQUAL(osValueType,&quot;Integer&quot;))
      {
           eDataType = GDT_Int32;
           bNoDataSet = TRUE;
           dfNoDataValue = -99999;
      }
      else if (EQUAL(osValueType,&quot;Char&quot;))
      {
           eDataType = GDT_Byte;
      }
      else
      {
           CSLDestroy( papszTokens );
            returnFALSE;
      }
 
      if( (i = CSLFindString( papszTokens,&quot;NODATA_value&quot; )) &gt;= 0 &amp;&amp; i + 1 &lt; nTokens)
      {
           const char* pszNoData = papszTokens[i+ 1];
 
           bNoDataSet = TRUE;
           dfNoDataValue = CPLAtofM(pszNoData);
           if((strchr( pszNoData, '.' ) != NULL||
                 strchr( pszNoData, ',' ) !=NULL ||
                 INT_MIN &gt; dfNoDataValue ||dfNoDataValue &gt; INT_MAX) )
           {
                 eDataType = GDT_Float32;
           }
 
           if( eDataType == GDT_Float32 )
           {
                 dfNoDataValue = (double)(float) dfNoDataValue;
           }
      }
 
      if ( (i = CSLFindString( papszTokens,&quot;MinV&quot; )) &gt;= 0 &amp;&amp; i + 1 &lt; nTokens)
           dfMin = CPLAtofM(papszTokens[i + 1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;MaxV&quot; )) &gt;= 0 &amp;&amp; i + 1 &lt; nTokens)
           dfMax = CPLAtofM(papszTokens[i + 1]);
 
      if ( (i = CSLFindString( papszTokens,&quot;Unit&quot; )) &gt;= 0 &amp;&amp; i + 1 &lt; nTokens)
           osUnitType = papszTokens[i + 1];
 
      if ( (i = CSLFindString( papszTokens,&quot;ZUnit&quot; )) &gt;= 0 &amp;&amp; i + 1 &lt; nTokens)
           osUnitType = papszTokens[i + 1];
 
      CSLDestroy( papszTokens );
      return TRUE;
}
 
 
/************************************************************************/
/*                         GetGeoTransform()                           */
/************************************************************************/
 
CPLErrCNSDTFDataset::GetGeoTransform( double * padfTransform )
 
{
      memcpy( padfTransform, adfGeoTransform,sizeof(double) * 6 );
      return( CE_None );
}
 
/************************************************************************/
/*                          GetProjectionRef()                          */
/************************************************************************/
 
constchar *CNSDTFDataset::GetProjectionRef()
 
{
      return pszProjection;
}
 
/************************************************************************/
/*                          CreateCopy()                                */
/************************************************************************/
 
GDALDataset* CNSDTFDataset::CreateCopy(
                                                        constchar * pszFilename, GDALDataset *poSrcDS,
                                                        intbStrict, char ** papszOptions,
                                                        GDALProgressFuncpfnProgress, void * pProgressData )
 
{
      int nBands = poSrcDS-&gt;GetRasterCount();
      int nXSize = poSrcDS-&gt;GetRasterXSize();
      int nYSize = poSrcDS-&gt;GetRasterYSize();
 
      /*-------------------------------------------------------------------- */
      /*     Some rudimentary checks                                         */
      /*-------------------------------------------------------------------- */
      if( nBands != 1 )
      {
           CPLError( CE_Failure,CPLE_NotSupported,
                 &quot;CNSDTF Grid driverdoesn't support %d bands.  Must be 1band.\n&quot;,
                 nBands );
 
           return NULL;
      }
 
      if( !pfnProgress( 0.0, NULL, pProgressData) )
           return NULL;
 
      /*-------------------------------------------------------------------- */
      /*     Create the dataset.                                             */
      /*-------------------------------------------------------------------- */
      VSILFILE        *fpImage;
 
      fpImage = VSIFOpenL( pszFilename,&quot;wt&quot; );
      if( fpImage == NULL )
      {
           CPLError( CE_Failure,CPLE_OpenFailed,
                 &quot;Unable to create file%s.\n&quot;, pszFilename );
           return NULL;
      }
 
      /*-------------------------------------------------------------------- */
      /*     Write CNSDTF Grid file header                                   */
      /*-------------------------------------------------------------------- */
      char szHeader[2000];    
      const char *pszForceRaster =CSLFetchNameValue( papszOptions, &quot;FORCE_RASTER&quot; );
      char* pszHeaderMark =&quot;DataMark:CNSDTF-DEM&quot;;
      if(pszForceRaster != NULL &amp;&amp;CSLTestBoolean(pszForceRaster))
           pszHeaderMark =&quot;DataMark:CNSDTF-RAS&quot;;
 
      double adfGeoTransform[6];
      poSrcDS-&gt;GetGeoTransform(adfGeoTransform );
 
      sprintf( szHeader,
           &quot;%s\n&quot;
            &quot;Version:GB/T17798-2007\n&quot;
           &quot;Alpha:0.0\n&quot;
           &quot;Compress:0\n&quot;
           &quot;X0:%.12f\n&quot;
           &quot;Y0:%.12f\n&quot;
           &quot;DX:%.12f\n&quot;
           &quot;DY:%.12f\n&quot;
           &quot;Row:%d\n&quot;
           &quot;Col:%d\n&quot;
           &quot;ValueType:Integer\n&quot;,    //Integer
           pszHeaderMark,
           adfGeoTransform[0],
           adfGeoTransform[3],
           ABS(adfGeoTransform[1]),
           ABS(adfGeoTransform[5]),
           nYSize, nXSize);
 
      /*-------------------------------------------------------------------- */
      /*     Try to write projection file.                                   */
      /* --------------------------------------------------------------------*/
      const char *pszOriginalProjection = poSrcDS-&gt;GetProjectionRef();
      if( !EQUAL( pszOriginalProjection,&quot;&quot; ) )
      {
           char                    *pszDirname, *pszBasename;
           char                    *pszPrjFilename;
           char                    *pszESRIProjection = NULL;
           VSILFILE                *fp;
           OGRSpatialReference     oSRS;
 
           pszDirname = CPLStrdup(CPLGetPath(pszFilename) );
           pszBasename = CPLStrdup(CPLGetBasename(pszFilename) );
 
           pszPrjFilename = CPLStrdup(CPLFormFilename( pszDirname, pszBasename, &quot;prj&quot; ) );
           fp = VSIFOpenL( pszPrjFilename,&quot;wt&quot; );
           if (fp != NULL)
           {
                 oSRS.importFromWkt( (char **)&amp;pszOriginalProjection );
                 oSRS.morphToESRI();
                 oSRS.exportToWkt(&amp;pszESRIProjection );
                 VSIFWriteL( pszESRIProjection,1, strlen(pszESRIProjection), fp );
 
                 VSIFCloseL( fp );
                 CPLFree( pszESRIProjection );
           }
           else
           {
                 CPLError( CE_Failure,CPLE_FileIO,
                      &quot;Unable to createfile %s.\n&quot;, pszPrjFilename );
           }
           CPLFree( pszDirname );
           CPLFree( pszBasename );
           CPLFree( pszPrjFilename );
      }
 
      GDALRasterBand * poBand =poSrcDS-&gt;GetRasterBand( 1 );
      double dfNoData, dfScale, dfMin, dfMax;
      int bSuccess;
 
      const char* pszUnitType =poBand-&gt;GetUnitType();
      if(pszUnitType != NULL)
           sprintf( szHeader+strlen(szHeader),&quot;ZUnit:%s\n&quot;, pszUnitType );
 
      // Write `nodata' value to header if it isexists in source dataset
      dfNoData = poBand-&gt;GetNoDataValue(&amp;bSuccess );
      if ( bSuccess )
           sprintf( szHeader+strlen(szHeader),&quot;NODATA_value:%6.20g\n&quot;, dfNoData );
 
      // Write `HZoom' value to header if it isexists in source dataset
      dfScale = poBand-&gt;GetScale(&amp;bSuccess );
      if ( !bSuccess )
           dfScale = 1.0;
      sprintf( szHeader+strlen(szHeader),&quot;HZoom:%.20g\n&quot;, dfScale );
 
      // Write `minmax' value to header if it isexists in source dataset
      dfMin = poBand-&gt;GetMinimum(&amp;bSuccess );
      if ( bSuccess )
           sprintf( szHeader+strlen(szHeader),&quot;MinV:%.20g\n&quot;, dfMin );
 
      dfMax = poBand-&gt;GetMaximum(&amp;bSuccess );
      if ( bSuccess )
           sprintf( szHeader+strlen(szHeader),&quot;MaxV:%.20g\n&quot;, dfMax );
 
      VSIFWriteL( szHeader, 1, strlen(szHeader),fpImage );
 
      /*-------------------------------------------------------------------- */
      /*    Builds the format string used for printing float values.         */
      /*-------------------------------------------------------------------- */
      char szFormatFloat[32];
      strcpy(szFormatFloat, &quot; %.20g&quot;);
      const char *pszDecimalPrecision =CSLFetchNameValue( papszOptions, &quot;DECIMAL_PRECISION&quot; );
      if (pszDecimalPrecision)
      {
           int nDecimal =atoi(pszDecimalPrecision);
           if (nDecimal &gt;= 0)
                 sprintf(szFormatFloat, &quot;%%.%dg&quot;, nDecimal);
      }
 
      /*-------------------------------------------------------------------- */
      /*     Loop over image, copying image data.                            */
      /*-------------------------------------------------------------------- */
      int        *panScanline = NULL;
      double     *padfScanline = NULL;
      int        bReadAsInt;
      int        iLine, iPixel;
      CPLErr     eErr = CE_None;
 
      bReadAsInt = (poBand-&gt;GetRasterDataType() == GDT_Byte
           || poBand-&gt;GetRasterDataType() ==GDT_Int16
           || poBand-&gt;GetRasterDataType() ==GDT_UInt16
           || poBand-&gt;GetRasterDataType() ==GDT_Int32 );
 
      // Write scanlines to output file
      if (bReadAsInt)
           panScanline = (int *) CPLMalloc(nXSize * GDALGetDataTypeSize(GDT_Int32) / 8 );
      else
           padfScanline = (double *) CPLMalloc(nXSize * GDALGetDataTypeSize(GDT_Float64) / 8 );
 
      for( iLine = 0; eErr == CE_None &amp;&amp;iLine &lt; nYSize; iLine++ )
      {
           CPLString osBuf;
           eErr = poBand-&gt;RasterIO( GF_Read,0, iLine, nXSize, 1,
                 (bReadAsInt) ?(void*)panScanline : (void*)padfScanline,
                 nXSize, 1, (bReadAsInt) ?GDT_Int32 : GDT_Float64, 0, 0 );
 
           if( bReadAsInt )
           {
                 for ( iPixel = 0; iPixel &lt;nXSize; iPixel++ )
                 {
                      sprintf( szHeader,&quot;%d &quot;, panScanline[iPixel] );
                      if(iPixel % 10 == 9)
                            sprintf(szHeader+strlen(szHeader), &quot;\n&quot; );
 
                      osBuf += szHeader;
                      if( (iPixel &amp; 1023) ==0 || iPixel == nXSize - 1 )
                      {
                            if ( VSIFWriteL(osBuf, (int)osBuf.size(), 1, fpImage ) != 1 )
                            {
                                  eErr =CE_Failure;
                                  CPLError(CE_Failure, CPLE_AppDefined, &quot;Write failed, disk full?\n&quot; );
                                  break;
                            }
                            osBuf =&quot;&quot;;
                      }
                 }
           }
           else
           {
                 for ( iPixel = 0; iPixel &lt;nXSize; iPixel++ )
                 {
                      sprintf( szHeader,szFormatFloat, padfScanline[iPixel] );
                      if(iPixel % 10 == 9)
                            sprintf(szHeader+strlen(szHeader), &quot;\n&quot; );
 
                      osBuf += szHeader;
                      if( (iPixel &amp; 1023) ==0 || iPixel == nXSize - 1 )
                       {
                            if ( VSIFWriteL(osBuf, (int)osBuf.size(), 1, fpImage ) != 1 )
                            {
                                  eErr =CE_Failure;
                                  CPLError(CE_Failure, CPLE_AppDefined, &quot;Write failed, disk full?\n&quot; );
                                  break;
                            }
                            osBuf =&quot;&quot;;
                      }
                 }
           }
           VSIFWriteL( (void *) &quot;\n&quot;,1, 1, fpImage );
 
           if( eErr == CE_None &amp;&amp;
                 !pfnProgress((iLine + 1) /((double) nYSize), NULL, pProgressData) )
           {
                 eErr = CE_Failure;
                 CPLError( CE_Failure,CPLE_UserInterrupt, &quot;User terminated CreateCopy()&quot; );
           }
      }
 
      CPLFree( panScanline );
      CPLFree( padfScanline );
      VSIFCloseL( fpImage );
 
      if( eErr != CE_None )
           return NULL;
 
      /*-------------------------------------------------------------------- */
      /*     Re-open dataset, and copy any auxilary pam information.         */
      /*-------------------------------------------------------------------- */
 
      /* If outputing to stdout, we can't reopenit, so we'll return */
      /* a fake dataset to make the caller happy*/
      CPLPushErrorHandler(CPLQuietErrorHandler);
      GDALPamDataset* poDS = (GDALPamDataset*)GDALOpen(pszFilename, GA_ReadOnly);
      CPLPopErrorHandler();
      if (poDS)
      {
           poDS-&gt;CloneInfo( poSrcDS,GCIF_PAM_DEFAULT );
           return poDS;
      }
 
      CPLErrorReset();
 
      CNSDTFDataset* poCnsdtfDS = newCNSDTFDataset();
      poCnsdtfDS-&gt;nRasterXSize = nXSize;
      poCnsdtfDS-&gt;nRasterYSize = nYSize;
      poCnsdtfDS-&gt;nBands = 1;
      poCnsdtfDS-&gt;SetBand( 1, newCNSDTFRasterBand( poCnsdtfDS, 1 ) );
      return poCnsdtfDS;
}</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">上面的代码中关于CNSDTF中的空间参考部分，由于定义的比较复杂，所以保留了直接读取同名的prj文件投影。在这里需要用到一个函数OSR_GDS，该函数的实现以及定义如下：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_4_7909331"  name="code" class="cpp">/************************************************************************/
/*                              OSR_GDS()                               */
/************************************************************************/
 
staticCPLString OSR_GDS( char **papszNV, const char * pszField,
                                   const char *pszDefaultValue )
 
{
      int        iLine;
 
      if( papszNV == NULL || papszNV[0] == NULL)
           return pszDefaultValue;
 
      for( iLine = 0;
           papszNV[iLine] != NULL &amp;&amp;
           !EQUALN(papszNV[iLine],pszField,strlen(pszField));
      iLine++ ) {}
 
      if( papszNV[iLine] == NULL )
           return pszDefaultValue;
      else
      {
           CPLString osResult;
           char    **papszTokens;
 
           papszTokens =CSLTokenizeString(papszNV[iLine]);
 
           if( CSLCount(papszTokens) &gt; 1 )
                 osResult = papszTokens[1];
           else
                 osResult = pszDefaultValue;
 
           CSLDestroy( papszTokens );
           return osResult;
      }
}</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">此外还写了从文件头中解析投影信息并组成WKT格式，目前还有国标中定义的两个投影（彭纳等积伪圆锥和等积斜轴切方位）没有找到与OSR中对应的，所以暂时没有处理。具体的代码如下：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_5_7767627"  name="code" class="cpp">staticchar *papszProjectionName[18] = {
      &quot;地理坐标系&quot;,
      &quot;高斯-克吕格&quot;,
      &quot;兰勃特正形割圆锥&quot;,
      &quot;兰勃特正形切圆锥&quot;,
      &quot;兰勃特等积方位&quot;,
      &quot;亚尔勃斯等积割圆锥&quot;,
      &quot;亚尔勃斯等积切圆锥&quot;,
      &quot;通用横轴墨卡托&quot;,
      &quot;墨卡托正轴等角切圆柱&quot;,
      &quot;墨卡托正轴等角割圆柱&quot;,
      &quot;波斯托等距切方位&quot;,
      &quot;彭纳等积伪圆锥&quot;,
      &quot;等积正轴切圆柱&quot;,
      &quot;等积正轴割圆柱&quot;,
      &quot;等距正轴切圆锥&quot;,
      &quot;等距正轴割圆锥&quot;,
      &quot;等积斜轴切方位&quot;,
      NULL
};
 
staticconst int nProjectionParametersIndex[18] = {
      0,         //0000000000    &quot;地理坐标系&quot;
      543,     //1000011111    &quot;高斯-克吕格&quot;
      972,     //1111001100    &quot;兰勃特正形割圆锥&quot;
      780,     //1100001100    &quot;兰勃特正形切圆锥&quot;
      796,     //1100011100    &quot;兰勃特等积方位&quot;
      543,     //1111001100    &quot;亚尔勃斯等积割圆锥&quot;
      972,     //1111001100    &quot;亚尔勃斯等积切圆锥&quot;
      525,     //1000001101    &quot;通用横轴墨卡托&quot;
      540,     //1000011100    &quot;墨卡托正轴等角切圆柱&quot;
      796,     //1100011100    &quot;墨卡托正轴等角割圆柱&quot;
      780,     //1100001100    &quot;波斯托等距切方位&quot;
      780,     //1100001100    &quot;彭纳等积伪圆锥&quot;
      524,     //1000001100    &quot;等积正轴切圆柱&quot;
      780,     //1100001100    &quot;等积正轴割圆柱&quot;
      780,     //1100001100    &quot;等距正轴切圆锥&quot;
      972,     //1111001100    &quot;等距正轴割圆锥&quot;
      796,     //1100011100    &quot;等积斜轴切方位&quot;
      0
};
 
/************************************************************************/
/*                   ParseSpatialReference()                          */
/************************************************************************/
 
CPLStringParseSpatialReference(const char* pszHeader)
{
      char** papszTokens = CSLTokenizeString2(pszHeader,  &quot; \n\r\t:：&quot;, 0 );
      int nTokens = CSLCount(papszTokens);
 
      int iCST = CSLFindString( papszTokens,&quot;CoordinateSystemType&quot; );
      if ( iCST&lt;0 || iCST+1 &gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find SRS&quot;);
           return &quot;&quot;;
      }
 
      char *pszCoordinateSystemType =papszTokens[iCST + 1];
      if (EQUAL(pszCoordinateSystemType,&quot;C&quot;))
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find SRS&quot;);
           return &quot;&quot;;
      }
 
      if ( (!EQUAL(pszCoordinateSystemType,&quot;D&quot;)) &amp;&amp; (!EQUAL(pszCoordinateSystemType, &quot;P&quot;)))
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find SRS&quot;);
           return &quot;&quot;;
      }
 
      int iSpheroid = CSLFindString(papszTokens, &quot;Spheroid&quot; );
      if ( iSpheroid&lt;0 || iSpheroid+1 &gt;=nTokens)
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find Spheroid, but the CoordinateSystemType is %s, this file headermaybe is wrong.&quot;, pszCoordinateSystemType);
           return &quot;&quot;;
      }
 
      char* pszSpheroid = papszTokens[iSpheroid+ 1];
      char** papszSpheroidTokens =CSLTokenizeString2( pszSpheroid,  &quot;,，&quot;, 0 );
      int nSpheroidTokens =CSLCount(papszSpheroidTokens);
      if(nSpheroidTokens != 3)
      {
           CSLDestroy( papszSpheroidTokens );
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;The Spheroid value is %s, maybe is wrong.&quot;, pszSpheroid);
           return &quot;&quot;;
      }
 
      char *pszPrimeMeridian =&quot;Greenwich&quot;;
      double dPrimeMeridian = 0.0;
      int iPrimeMeridian = CSLFindString(papszTokens, &quot;PrimeMeridian&quot; );
      if ( iPrimeMeridian&gt;=0 &amp;&amp;iPrimeMeridian+1 &lt; nTokens)
      {
           char* pszPrimeMeridianValue =papszTokens[iPrimeMeridian + 1];
           if (!EQUAL(pszPrimeMeridian,pszPrimeMeridianValue))
           {
                 char** papszPrimeMeridianTokens= CSLTokenizeString2( pszPrimeMeridianValue, &quot;,，&quot;, 0 );
                 int nPrimeMeridianTokens =CSLCount(papszPrimeMeridianTokens);
                 if(nPrimeMeridianTokens == 2)
                 {
                      pszPrimeMeridian =papszPrimeMeridianTokens[0];
                      dPrimeMeridian =CPLAtofM(papszPrimeMeridianTokens[1]);
                 }
 
                 CSLDestroy(papszPrimeMeridianTokens );
           }
      }
 
      double dSemiMajor =CPLAtofM(papszSpheroidTokens[1]);
      double dInvFlattening = CPLAtofM(papszSpheroidTokens[2]);
      if (dSemiMajor &lt; 6400)  //unit is km
           dSemiMajor *= 1000;
 
      OGRSpatialReference oSRS;
      oSRS.SetGeogCS(papszSpheroidTokens[0],
           &quot;unknown&quot;,
           papszSpheroidTokens[0],
           dSemiMajor, dInvFlattening,
           pszPrimeMeridian, dPrimeMeridian,
           &quot;degree&quot;,0.0174532925199433 );
 
      char* pszWkt = NULL;
 
      if (EQUAL(pszCoordinateSystemType,&quot;D&quot;))
      {
           oSRS.exportToWkt( &amp;pszWkt );
           CSLDestroy( papszTokens );
           return CPLString(pszWkt);
      }
 
      int iProjection = CSLFindString(papszTokens, &quot;Projection&quot; );
      if ( iProjection&lt;0 || iProjection+1&gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find Projection&quot;);
           return &quot;&quot;;
      }
 
      char* pszProjection =papszTokens[iProjection+1];
      if(EQUAL(pszProjection, &quot;地理坐标系&quot;))
      {
           oSRS.exportToWkt( &amp;pszWkt );
           CSLDestroy( papszTokens );
           return CPLString(pszWkt);
      }
 
      int iProjectionType = CSLFindString(papszProjectionName, pszProjection );
      if (iProjectionType&lt;=0)
      {
           oSRS.exportToWkt( &amp;pszWkt );
           CSLDestroy( papszTokens );
           return CPLString(pszWkt);
      }
 
      int iParametersIndex =nProjectionParametersIndex[iProjectionType];
 
      int iParameters = CSLFindString(papszTokens, &quot;Parameters&quot; );
      if ( iParameters&lt;0 || iParameters+1&gt;= nTokens)
      {
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Can't find Projection Parameters&quot;);
           return &quot;&quot;;
      }
 
      char* pszParameters =papszTokens[iParameters+1];
      char** papszParametersTokens =CSLTokenizeString2( pszParameters, &quot;,，&quot;, CSLT_ALLOWEMPTYTOKENS);
      int nParametersTokens =CSLCount(papszParametersTokens);
      if(nParametersTokens != 10)
      {
           CSLDestroy( papszParametersTokens );
           CSLDestroy( papszTokens );
           CPLDebug( &quot;CNSDTF Grid&quot;,&quot;Parse projection parameters error, the count should be 10, but now is%d&quot;, nParametersTokens);
           return &quot;&quot;;
      }
 
      double dParmeters[10] = {0.0};
      for (int i=0; i&lt;10; i++)
           dParmeters[i] =CPLAtofM(papszParametersTokens[i]);
 
      switch(iProjectionType)
      {
      case 1: //高斯-克吕格
           oSRS.SetTM(0.0, dParmeters[0],dParmeters[5], dParmeters[6], dParmeters[7]);
           break;
      case 2: //兰勃特正形割圆锥
           oSRS.SetLCC(dParmeters[2],dParmeters[3], dParmeters[1], dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 3: //兰勃特正形切圆锥
           oSRS.SetLCC(dParmeters[1],dParmeters[1], dParmeters[1], dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 4: //兰勃特等积方位
           oSRS.SetLAEA(dParmeters[1],dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 5: //亚尔勃斯等积割圆锥
           oSRS.SetACEA(dParmeters[2], dParmeters[3],dParmeters[1], dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 6: //亚尔勃斯等积切圆锥
           oSRS.SetACEA(dParmeters[1],dParmeters[1], dParmeters[1], dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 7: //通用横轴墨卡托
           {
                 int dZone =((int)(dParmeters[0]) + 183) / 6;
                 int bIsNorth = TRUE;
                 if(dParmeters[7] &gt;=10000000)
                      bIsNorth = FALSE;
 
                 oSRS.SetUTM(dZone, bIsNorth);
           }
           break;
      case 8: //墨卡托正轴等角切圆柱
           oSRS.SetMercator(0.0, dParmeters[0],dParmeters[5], dParmeters[6], dParmeters[7]);
           break;
      case 9: //墨卡托正轴等角割圆柱
           oSRS.SetMercator(dParmeters[1],dParmeters[0], dParmeters[5], dParmeters[6], dParmeters[7]);
           break;
      case 10:     //波斯托等距切方位
           oSRS.SetAE(dParmeters[1],dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 11:     //彭纳等积伪圆锥
           // dont know which one is match
           break;
      case 12:     //等积正轴切圆柱
           oSRS.SetCEA(0.0, dParmeters[0],dParmeters[6], dParmeters[7]);
           break;
      case 13:     //等积正轴割圆柱
           oSRS.SetCEA(dParmeters[1],dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 14:     //等距正轴切圆锥
           oSRS.SetMC(dParmeters[1],dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 15:     //等距正轴割圆锥
           oSRS.SetEC(dParmeters[2],dParmeters[3], dParmeters[1], dParmeters[0], dParmeters[6], dParmeters[7]);
           break;
      case 16:     //等积斜轴切方位
           // dont know which one is match
           break;
      default:
           {
                 CSLDestroy(papszParametersTokens );
                 CSLDestroy( papszTokens );
                 CPLDebug( &quot;CNSDTFGrid&quot;, &quot;Can not support this projection %s&quot;,papszProjectionName);
                 return &quot;&quot;;
           }
      }
 
      CSLDestroy( papszParametersTokens );
 
      oSRS.exportToWkt( &amp;pszWkt );
      CSLDestroy( papszTokens );
      return CPLString(pszWkt);
}</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">接下来关于Dataset相关的所有的都已经实现，剩下就是GDALRasterBand类了。同样，按照官方文档中的说明，首先从GDALRasterBand类中派生一个类CNSDTFRasterBand，下面是该类的定义。</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_6_6197464"  name="code" class="cpp">/************************************************************************/
/*==================================================================== */
/*                           CNSDTFRasterBand                         */
/*==================================================================== */
/************************************************************************/
 
classCNSDTFRasterBand : public GDALPamRasterBand
{
      friend class CNSDTFDataset;
 
      GUIntBig      *panLineOffset;
      char          *pszUnitType;
      double        dfScale;
 
public:
 
      CNSDTFRasterBand( CNSDTFDataset *poDS, intnDataStart);
      virtual       ~CNSDTFRasterBand();
 
      virtual double GetMinimum( int *pbSuccess);
      virtual double GetMaximum( int *pbSuccess);
      virtual double GetNoDataValue( int *pbSuccess);
      virtual CPLErr SetNoDataValue( doubledfNoData);
      virtual const char *GetUnitType();
      CPLErr SetUnitType( const char *pszNewValue);
      virtual double GetScale( int *pbSuccess =NULL );
      CPLErr SetScale( double dfNewScale);
 
      virtual CPLErr IReadBlock( int nBlockXOff,int nBlockYOff, void * pImage);
};</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">接下来就是CNSDTFRasterBand类的具体实现。</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_7_4419557"  name="code" class="cpp">/************************************************************************/
/*                          CNSDTFRasterBand()                         */
/************************************************************************/
 
CNSDTFRasterBand::CNSDTFRasterBand(CNSDTFDataset *poDS, int nDataStart )
 
{
      this-&gt;poDS = poDS;
 
      nBand = 1;
      eDataType = poDS-&gt;eDataType;
 
      nBlockXSize = poDS-&gt;nRasterXSize;
      nBlockYSize = 1;
 
      panLineOffset =
           (GUIntBig *) VSICalloc(poDS-&gt;nRasterYSize, sizeof(GUIntBig) );
      if (panLineOffset == NULL)
      {
           CPLError(CE_Failure,CPLE_OutOfMemory,
                 &quot;CNSDTFRasterBand::CNSDTFRasterBand: Out of memory (nRasterYSize = %d)&quot;,
                 poDS-&gt;nRasterYSize);
           return;
      }
 
      panLineOffset[0] = nDataStart;
      dfScale = poDS-&gt;nHZoom;
      pszUnitType =CPLStrdup(poDS-&gt;osUnitType.c_str());
}
 
/************************************************************************/
/*                         ~CNSDTFRasterBand()                         */
/************************************************************************/
 
CNSDTFRasterBand::~CNSDTFRasterBand()
 
{
      CPLFree( panLineOffset );
      CPLFree( pszUnitType );
}
 
/************************************************************************/
/*                             IReadBlock()                             */
/************************************************************************/
 
CPLErrCNSDTFRasterBand::IReadBlock( int nBlockXOff, int nBlockYOff,
                                                  void* pImage )
 
{
      CNSDTFDataset *poODS = (CNSDTFDataset *)poDS;
      int        iPixel;
 
      if( nBlockYOff &lt; 0 || nBlockYOff &gt;poODS-&gt;nRasterYSize - 1
           || nBlockXOff != 0 || panLineOffset== NULL || poODS-&gt;fp == NULL )
           return CE_Failure;
 
      if( panLineOffset[nBlockYOff] == 0 )
      {
           int iPrevLine;
 
           for( iPrevLine = 1; iPrevLine &lt;=nBlockYOff; iPrevLine++ )
                 if( panLineOffset[iPrevLine] ==0 )
                      IReadBlock( nBlockXOff,iPrevLine-1, NULL );
      }
 
      if( panLineOffset[nBlockYOff] == 0 )
           return CE_Failure;
 
 
      if( poODS-&gt;Seek(panLineOffset[nBlockYOff] ) != 0 )
      {
           CPLError( CE_Failure, CPLE_FileIO,
                 &quot;Can't seek to offset %luin input file to read data.&quot;,
                 (long unsignedint)panLineOffset[nBlockYOff] );
           return CE_Failure;
      }
 
      for( iPixel = 0; iPixel &lt;poODS-&gt;nRasterXSize; )
      {
           char szToken[500];
           char chNext;
           int iTokenChar = 0;
 
           /* suck up any pre-white space. */
           do {
                 chNext = poODS-&gt;Getc();
           } while( isspace( (unsignedchar)chNext ) );
 
           while( chNext != '\0' &amp;&amp;!isspace((unsigned char)chNext)  )
           {
                 if( iTokenChar ==sizeof(szToken)-2 )
                 {
                      CPLError( CE_Failure,CPLE_FileIO,
                            &quot;Token too longat scanline %d.&quot;,
                            nBlockYOff );
                      return CE_Failure;
                 }
 
                 szToken[iTokenChar++] = chNext;
                 chNext = poODS-&gt;Getc();
           }
 
           if( chNext == '\0' &amp;&amp;
                 (iPixel !=poODS-&gt;nRasterXSize - 1 ||
                 nBlockYOff !=poODS-&gt;nRasterYSize - 1) )
           {
                 CPLError( CE_Failure,CPLE_FileIO,
                      &quot;File short, can'tread line %d.&quot;,
                      nBlockYOff );
                 return CE_Failure;
           }
 
           szToken[iTokenChar] = '\0';
 
           if( pImage != NULL )
           {
                 if( eDataType == GDT_Float64 )
                      ((double *)pImage)[iPixel] = CPLAtofM(szToken);
                 else if( eDataType ==GDT_Float32 )
                      ((float *) pImage)[iPixel]= (float) CPLAtofM(szToken);
                 else
                      ((GInt32 *)pImage)[iPixel] = (GInt32) atoi(szToken);
           }
 
           iPixel++;
      }
 
      if( nBlockYOff &lt; poODS-&gt;nRasterYSize- 1 )
           panLineOffset[nBlockYOff + 1] =poODS-&gt;Tell();
 
      return CE_None;
}
 
/************************************************************************/
/*                             GetMinimum()                             */
/************************************************************************/
 
doubleCNSDTFRasterBand::GetMinimum( int *pbSuccess )
 
{
      CNSDTFDataset *poODS = (CNSDTFDataset *) poDS;
 
      if( pbSuccess != NULL )
           *pbSuccess = TRUE;
 
      return poODS-&gt;dfMin;
}
 
/************************************************************************/
/*                             GetMaximum()                             */
/************************************************************************/
 
doubleCNSDTFRasterBand::GetMaximum( int *pbSuccess )
 
{
      CNSDTFDataset *poODS = (CNSDTFDataset *) poDS;
 
      if( pbSuccess != NULL )
           *pbSuccess = TRUE;
 
      return poODS-&gt;dfMax;
}
 
/************************************************************************/
/*                          GetNoDataValue()                           */
/************************************************************************/
 
doubleCNSDTFRasterBand::GetNoDataValue( int * pbSuccess )
 
{
      CNSDTFDataset *poODS = (CNSDTFDataset *) poDS;
 
      if( pbSuccess )
           *pbSuccess = poODS-&gt;bNoDataSet;
 
      return poODS-&gt;dfNoDataValue;
}
 
 
/************************************************************************/
/*                          SetNoDataValue()                           */
/************************************************************************/
 
CPLErrCNSDTFRasterBand::SetNoDataValue( double dfNoData )
 
{
      CNSDTFDataset *poODS = (CNSDTFDataset *)poDS;
 
      poODS-&gt;bNoDataSet = TRUE;
      poODS-&gt;dfNoDataValue = dfNoData;
 
      return CE_None;
}
 
/************************************************************************/
/*                            GetUnitType()                             */
/************************************************************************/
 
constchar *CNSDTFRasterBand::GetUnitType()
 
{
      if( pszUnitType == NULL )
           return &quot;&quot;;
      else
           return pszUnitType;
}
 
/************************************************************************/
/*                            SetUnitType()                             */
/************************************************************************/
 
CPLErrCNSDTFRasterBand::SetUnitType( const char *pszNewValue )
 
{
      CPLFree( pszUnitType );
 
      if( pszNewValue == NULL )
           pszUnitType = NULL;
      else
           pszUnitType = CPLStrdup(pszNewValue);
 
      return CE_None;
}
 
/************************************************************************/
/*                              GetScale()                              */
/************************************************************************/
 
doubleCNSDTFRasterBand::GetScale( int *pbSuccess )
 
{
      if( pbSuccess != NULL )
           *pbSuccess = TRUE;
 
      return dfScale;
}
 
/************************************************************************/
/*                              SetScale()                              */
/************************************************************************/
 
CPLErrCNSDTFRasterBand::SetScale( double dfNewScale )
 
{
      dfScale = dfNewScale;
      return CE_None;
}</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">至此，基本上所有的源码都已经编写完毕，接下来就是将源码加入到GDAL源码中进行编译。首先将上面的代码写成cpp和h文件，也可以写一个cpp。并且在cpp的末尾加上一个函数，用来注册使用，具体代码如下，主要就是对该格式的一些描述，以及是否可以创建，删除等，可以参考其他的驱动来进行修改就可以了。</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_8_3198058"  name="code" class="cpp">/************************************************************************/
/*                      GDALRegister_CNSDTFGrid()                      */
/************************************************************************/
 
voidGDALRegister_CNSDTFGrid()
 
{
      GDALDriver *poDriver;
 
      if( GDALGetDriverByName(&quot;CNSDTF-GRD&quot; ) == NULL )
      {
           poDriver = new GDALDriver();
 
           poDriver-&gt;SetDescription(&quot;CNSDTF-GRD&quot; );
           poDriver-&gt;SetMetadataItem(GDAL_DMD_LONGNAME,
                 &quot;China Geospatial DataTransfer Grid Format (.grd)&quot; );
           poDriver-&gt;SetMetadataItem(GDAL_DMD_HELPTOPIC,
                 &quot;frmt_cnsdtf.html&quot; );
           poDriver-&gt;SetMetadataItem(GDAL_DMD_EXTENSION, &quot;grd&quot; );
           poDriver-&gt;SetMetadataItem(GDAL_DMD_CREATIONDATATYPES,
                 &quot;Byte UInt16 Int16Int32&quot; );
 
           poDriver-&gt;SetMetadataItem(GDAL_DCAP_VIRTUALIO, &quot;YES&quot; );
           poDriver-&gt;SetMetadataItem(GDAL_DMD_CREATIONOPTIONLIST,
                 &quot;&lt;CreationOptionList&gt;\n&quot;
                 &quot;   &lt;Option name='FORCE_RASTER'type='boolean' description='Force use of RASTER, default isFALSE(DEM).'/&gt;\n&quot;
                 &quot;   &lt;Option name='DECIMAL_PRECISION'type='int' description='Number of decimal when writing floating-pointnumbers.'/&gt;\n&quot;
                 &quot;&lt;/CreationOptionList&gt;\n&quot;);
 
           poDriver-&gt;pfnOpen =CNSDTFDataset::Open;
           poDriver-&gt;pfnIdentify =CNSDTFDataset::Identify;
           poDriver-&gt;pfnCreateCopy =CNSDTFDataset::CreateCopy;
 
           GetGDALDriverManager()-&gt;RegisterDriver(poDriver );
      }
}</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px; "><strong>四、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</strong></span><span style="color: rgb(0, 0, 153);font-size:14px; "><strong>修改GDAL编译文件</strong></span></p><p align="left"><span style="font-size:14px;color:#000099;">上面基本上编写完了所有的代码，下面就需要修改GDAL库中的部分文件，然后编译来使GDAL支持新的文件格式。</span></p><p align="left"><span style="font-size:14px;color:#000099;">1、在frmts文件夹中新建一个cnsdtf的文件夹，将上面的代码放到该文件夹中，并新建三个文件，分别是frmt_cnsdtf.html、makefile.vc&nbsp;和GNUmakefile。frmt_cnsdtf.html这个文件主要就是对新的文件格式的一个说明，书写方式可以参考其他文件夹中的文件。makefile.vc和GNUmakefile分别对应于windows系统和Linux系统下的编译文件，这里只编译Window版本，所以只编写makefile.vc文件，编辑完的内容如下：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_9_3056354"  name="code" class="plain"> 
OBJ =   cnsdtfdataset.objcnsdtfsrs.obj
 
GDAL_ROOT =   ..\..
 
!INCLUDE$(GDAL_ROOT)\nmake.opt
 
default: $(OBJ)
      xcopy /D /Y *.obj ..\o
 
clean:
      -del *.obj
 </pre></p><p align="left"><span style="font-size:14px;color:#000099;">2、修改frmts文件夹中的gdalallregister.cpp文件，在代码中的最后将新的文件驱动进行注册进去，如下（红色的为新增的）：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_10_9675264"  name="code" class="cpp">#ifdefFRMT_iris
    GDALRegister_IRIS();
#endif
 
#ifdefFRMT_cnsdtf
    GDALRegister_CNSDTFGrid(); //红色
#endif</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">3、修改frmts文件夹中的makefile.vc，在EXTRAFLAGS的最后没添加-DFRMT_cnsdtf，需要与步骤2中的一致。</span></p><p align="left"><span style="font-size:14px;color:#000099;">4、修改gcore文件夹中的gdal_frmts.h文件，在最后添加新驱动注册声明。如下（红色的为新增的）：</span></p><p align="left"><pre code_snippet_id="156599" snippet_file_name="blog_20140114_11_2041816"  name="code" class="cpp">voidCPL_DLL GDALRegister_IRIS(void);
voidCPL_DLL GDALRegister_CNSDTFGrid(void); //红色</pre><br /><span style="color: rgb(0, 0, 153);font-size:14px;">5、修改完上面的文件，然后将GDAL工程清理掉之后重新编译，如果提示有语法错误，请先修改代码中的语法错误，如果没有，正常编译完成的话，就是用gdalinfo工具（或者其他的工具）中的命令行参数—formats（下图1）或者—format CNSDTF-GRD（下图2）来进行查看是否新的驱动已经包含在内。如果输出有CNSDTF的字样，说明新的驱动添加成功。下面我们使用gdalinfo来对真实的数据进行测试。</span></p><p align="left" style="text-align: center;"><img src="http://img.blog.csdn.net/20140114194447828?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGltaW5sdTAzMTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p><p align="center"><span style="font-size:14px;color:#000099;">图1 –formats命令</span></p><p align="left" style="text-align: center;"><img src="http://img.blog.csdn.net/20140114194523687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGltaW5sdTAzMTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p><p align="center"><span style="font-size:14px;color:#000099;">图2 —format CNSDTF-GRD命令</span></p><p align="left"><span style="font-size:14px;color:#000099;"><strong>五、&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;测试</strong></span></p><p align="left"><span style="font-size:14px;color:#000099;">为了测试我们新添加的驱动是否能够正确读取数据，我们使用gdalinfo工具来进行检验。使用的命令行如下所示：</span></p><p align="left"><span style="font-size:14px;color:#000099;">gdalinfo –checksum --configGDAL_FILENAME_IS_UTF8 NO F:\我的资料\cnsdtf\sample.grd</span></p><p align="left"><span style="font-size:14px;color:#000099;">使用-checksum的原因是为了检验GDAL读取像素值是否正确，--config是为了支持中文路径，如果程序不报错，并且能够输出下面的信息，说明基本上读取是没有问题了。</span></p><p align="left" style="text-align: center;"><img src="http://img.blog.csdn.net/20140114194555125?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGltaW5sdTAzMTQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="" /></p><p align="left"><span style="font-size:14px;color:#000099;">接下来可以建议创建图像的功能，可以使用gdal_translate工具，将一个其他格式的单波段数据进行转换成CNSDTF格式，然后使用gdalinfo的-checksum命令，如果两个图像转换前后的checksum值计算的相同，那么就说明创建应该是没有问题的。</span></p><p align="left"><span style="font-size:14px;color:#000099;">之后我会将CNSDTF格式的代码申请提交到GDAL的库中，如果GDAL接收的话，那么以后就可以直接支持了，如果没有接收，使用上面的方式自己扩展一下也问题不大。接下来有时间的话会将Create方法进行实现，同时也将矢量格式也扩展到OGR库中。</span></p>   
</div>




<!-- Baidu Button BEGIN -->




<div class="bdsharebuttonbox tracking-ad" style="float: right;" data-mod="popu_172">
<a href="#" class="bds_more" data-cmd="more" style="background-position:0 0 !important; background-image: url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png) !important"></a>
<a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"  style="background-position:0 -52px !important"></a>
<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"style="background-position:0 -104px !important"></a>
<a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"style="background-position:0 -260px !important"></a>
<a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"style="background-position:0 -208px !important"></a>
<a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"style="background-position:0 -1612px !important" ></a>
</div>
<script>window._bd_share_config = { "common": { "bdSnsKey": {}, "bdText": "", "bdMini": "1", "bdMiniList": false, "bdPic": "", "bdStyle": "0", "bdSize": "16" }, "share": {} }; with (document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = 'http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion=' + ~(-new Date() / 36e5)];</script>
<!-- Baidu Button END -->

   

    
<!--172.16.140.13-->

<!-- Baidu Button BEGIN -->
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=1536434" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
    document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
<!-- Baidu Button END -->



 


        <div id="digg" ArticleId="18270629" >
            <dl id="btnDigg" class="digg digg_disable"  onclick="btndigga();">
               
                 <dt>顶</dt>
                <dd>2</dd>
            </dl>
           
              
            <dl id="btnBury" class="digg digg_disable"  onclick="btnburya();">
              
                  <dt>踩</dt>
                <dd>0</dd>               
            </dl>
            
        </div>
     <div class="tracking-ad" data-mod="popu_222"><a href="javascript:void(0);" >&nbsp;</a>   </div>
    <div class="tracking-ad" data-mod="popu_223"> <a href="javascript:void(0);" >&nbsp;</a></div>
    <script type="text/javascript">
                function btndigga() {
                    $(".tracking-ad[data-mod='popu_222'] a").click();
                }
                function btnburya() {
                    $(".tracking-ad[data-mod='popu_223'] a").click();
                }
            </script>

   <ul class="article_next_prev">
                <li class="prev_article"><span  onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian']);location.href='/liminlu0314/article/details/17400075';">上一篇</span><a href="/liminlu0314/article/details/17400075" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_shangyipian'])">QGIS编译</a></li>
                <li class="next_article"><span onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian']);location.href='/liminlu0314/article/details/18446429';">下一篇</span><a href="/liminlu0314/article/details/18446429" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_xiayipian'])">GDAL库中WFS服务中含有中文不能获取数据的问题</a></li>
    </ul>

    <div style="clear:both; height:10px;"></div>


            <div class="similar_article"   >
                    <h4></h4>
                    <div class="similar_c"style="margin:20px 0px 0px 0px">
                        <div class="similar_c_t">
                          &nbsp;&nbsp;相关文章推荐
                        </div>
                   
                        <div class="similar_wrap tracking-ad" data-mod="popu_36"  style="max-height:195px;">                       
                            <ul class="similar_list fl">    
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/liminlu0314/article/details/48684123" title="GDAL库扩展Landsat系列MTL文件格式支持" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL库扩展Landsat系列MTL文件格式支持</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/giskekezhou/article/details/6925939" title="fedora15编译gdal1.8及扩展格式支持" strategy="recommend_sim_0" target="_blank" style="width: 290px;">fedora15编译gdal1.8及扩展格式支持</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/liminlu0314/article/details/7599900" title="GDAL源码剖析（十）之编写自己的扩展格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL源码剖析（十）之编写自己的扩展格式</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/yyt_EnjoyVC/article/details/7769148" title="GDAL 支持的图像格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL 支持的图像格式</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/liminlu0314/article/details/42499059" title="GDAL不支持创建PCIDSK的面状矢量格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL不支持创建PCIDSK的面状矢量格式</a>
                                   </li>
                            </ul>
                              <ul class="similar_list fr">      
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/ranran_5300/article/details/50540351" title="GDAL/ORG 支持的格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL/ORG 支持的格式</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/IvanLJF/article/details/8479701" title="安装和配置gdal以及让其支持hdf4和hdf5格式数据的步骤" strategy="recommend_sim_0" target="_blank" style="width: 290px;">安装和配置gdal以及让其支持hdf4和hdf5格式数据的步骤</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/dzm12/article/details/40423241" title="GDAL支持的数据格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">GDAL支持的数据格式</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/liminlu0314/article/details/7433936" title="使用GDAL构造OpenCV的图像格式" strategy="recommend_sim_0" target="_blank" style="width: 290px;">使用GDAL构造OpenCV的图像格式</a>
                                   </li>
                                   <li>
                                       <em>•</em>
                                       <a href="http://blog.csdn.net/liminlu0314/article/details/6127755" title="使用GDAL创建Erdas格式的金字塔" strategy="recommend_sim_0" target="_blank" style="width: 290px;">使用GDAL创建Erdas格式的金字塔</a>
                                   </li>
                            </ul>
                        </div>
                    </div>
                </div>   
      
</div>

    <div>
        

        <script type="text/javascript">
            /*博客内容页下方Banner1-728*90，创建于2016-12-13*/
            var cpro_id = "u2843949";
        </script>
        <script type="text/javascript" src="http://cpro.baidustatic.com/cpro/ui/c.js"></script>

     </div>

<div id="suggest"></div>
         <script  language="javascript" type='text/javascript'>     
             $(function(){
                 $.get("/liminlu0314/svc/GetSuggestContent/18270629",function(data){
                     $("#suggest").html(data);
                 });     
             });             
         </script>  


<style>
.blog-ass-articl dd {
color: #369;
width: 99%; /*修改行*/
float: left;
overflow: hidden;
font: normal normal 12px/23px "SimSun";
height: 23px;
margin: 0;
padding: 0 0 0 10px;
margin-right: 30px;
background: url(http://static.blog.csdn.net/skin/default/images/blog-dot-red3.gif) no-repeat 0 10px;
}
</style>

 
<div id="relate" data-mod="popu_218"  class="tracking-ad">
        <div class="relate_t">
            <h3><span>参考知识库</span></h3>
        </div>
        <div class="relate_c">
        </div>
</div>
 

<dl class="blog-ass-articl tracking-ad" id="res-relatived" data-mod="popu_84"  > 
    <div class="embody embody_b" id="libkeyparent"  style="display:none">
            <span class="embody_t">更多资料请参考：</span>
            <div class="embody_c" id="libkey"></div>
    </div>


     <dt><span>猜你在找</span></dt>    


   

    
    <div id="adCollege"> 
    </div>  

    

     <script src="http://csdnimg.cn/jobreco/job_reco.js" type="text/javascript"></script> 
     <script type="text/javascript">
         csdn.position.showEdu({
             sourceType: "blog",
             searchType: "detail",
             searchKey: "18270629",
                username: "",
                recordcount: "10",
                containerId: "adCollege" //容器DIV的id。 
            });  
        </script> 
   
</dl>





    <div id="ad_cen">        
                <div>
                              <script type="text/javascript">
                                  /*博客内容页下方Banner-728*90，创建于2014-7-3*/
                                  var cpro_id = "u1607657";
                                            </script>
                              <script type="text/javascript" src="http://cpro.baidustatic.com/cpro/ui/c.js"></script>
                    </div>
    </div>  

        <!-- 广告位开始 -->
        <!-- 广告位结束 -->
<div class="tracking-ad" data-view="true" data-mod="ad_popu_72" data-mtp="62" data-order="40" data-con="ad_content_2072">
                 <script id="popuLayer_js_q" src="http://ads.csdn.net/js/popuLayer.js" defer="defer"  type="text/javascript"></script>
            <div id="layerd" style="position: fixed;bottom:0px;right:0px;line-height:0px;z-index:1000">
    	            <div class="J_close layer_close" style="display:;background-color:#efefef;padding:0px;color:#333;font:12px/24px Helvetica,Tahoma,Arial,sans-serif;text-align:right;">关闭</div><!-- 广告占位容器 --><div id="cpro_u2895327"></div></div>
            <script>  document.getElementById("popuLayer_js_q").onload=function(){      var styObjd=styObj={width:"300px","height":parseInt(250)+28};window.CSDN.Layer.PopuLayer("#layerd",{storageName:"layerd",styleObj:styObjd,total:50,expoire:1000*60});  }</script><!-- 投放代码 --><script type="text/javascript">                /*服务器频道首页置顶Banner960*90，创建于2014-7-3*/    (window.cproArray = window.cproArray || []).push({        id: "u2895327"      });  </script>  <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
     
</div>

<div class="comment_class">
    <div id="comment_title" class="panel_head">
        <span class="see_comment">查看评论</span><a name="comments"></a></div>
    <div id="comment_list">
    </div>
    <div id="comment_bar">
    </div>
    <div id="comment_form">
    </div>
    <div class="announce">
        * 以上用户言论只代表其个人观点，不代表CSDN网站的观点或立场<a name="reply"></a><a name="quote"></a></div>
</div>

<script type="text/javascript">
    var fileName = '18270629';
    var commentscount = 2;
    var islock = false
</script>

    <div id="ad_bot">
    </div>
<div id="report_dialog">
</div>

<div id="d-top"  style="bottom:60px;">

        <a id="quick-reply" class="btn btn-top q-reply" title="快速回复" style="display:none;">
            <img src="http://static.blog.csdn.net/images/blog-icon-reply.png" alt="快速回复">
        </a>    
    <a id="d-top-a" class="btn btn-top backtop"  style="display: none;" title="返回顶部" onclick="_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_huidaodingbu'])" style="">         
         <img src="http://static.blog.csdn.net/images/top.png" alt="TOP">
    </a>
</div>
<script type="text/javascript">
    $(function ()
    {
        $("#ad_frm_0").height("90px");
        
        setTimeout(function(){
            $("#ad_frm_2").height("200px");
        },1000);    
    });
  
</script>
<style type="text/css">
    .tag_list
    {
        background: none repeat scroll 0 0 #FFFFFF;
        border: 1px solid #D7CBC1;
        color: #000000;
        font-size: 12px;
        line-height: 20px;
        list-style: none outside none;
        margin: 10px 2% 0 1%;
        padding: 1px;
    }
    .tag_list h5
    {
        background: none repeat scroll 0 0 #E0DBD3;
        color: #47381C;
        font-size: 12px;
        height: 24px;
        line-height: 24px;
        padding: 0 5px;
        margin: 0;
    }
    .tag_list h5 a
    {
        color: #47381C;
    }
    .classify
    {
        margin: 10px 0;
        padding: 4px 12px 8px;
    }
    .classify a
    {
        margin-right: 20px;
        white-space: nowrap;
    }
</style>


<div class="tag_list" style="display:none"></div>
  <script  type='text/javascript'>     
      $(function(){
              setTimeout(function(){
                  $.get("/liminlu0314/svc/GetTagContent",function(data){
                      $(".tag_list").html(data).show();
                  });     
              });
          },500);                       
 </script> 


<div id="pop_win" style="display:none ;position: absolute; z-index: 10000; border: 1px solid rgb(220, 220, 220); top: 222.5px; left: 630px; opacity: 1; background: none 0px 0px repeat scroll rgb(255, 255, 255);">
    
</div>
<div id="popup_mask"></div>
<style>
    #popup_mask
    {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 9999;
        left: 0px;
        top: 0px;
        opacity: 0.3;
        filter: alpha(opacity=30);
        display: none;
    }

</style>




<script type="text/javascript">
    $(function(){        
        
        setTimeout(function(){
            $(".comment_body:contains('回复')").each(function(index,item){
                var u=$(this).text().split('：')[0].toString().replace("回复","")
                var thisComment=$(this);
                if(u)
                {
                    $.getJSON("https://passport.csdn.net/get/nick?callback=?", {users: u}, function(a) {
                        if(a!=null&&a.data!=null&&a.data.length>0)
                        {
                            nick=a.data[0].n; 
                            if(u!=nick)
                            {
                                thisComment.text(thisComment.text().replace(u,nick));  
                            }
                        }       
                    });  
                }
            });         

        },200);  

        setTimeout(function(){
            $(".math").each(function(index,value){$(this).find("span").last().css("color","#fff"); })
        },5000);

        setTimeout(function(){
            $(".math").each(function(index,value){$(this).find("span").last().css("color","#fff"); })
        },10000);

        setTimeout(function(){
            $(".math").each(function(index,value){$(this).find("span").last().css("color","#fff"); })
        },15000);
        
        setTimeout(function(){
            $("a img[src='http://js.tongji.linezing.com/stats.gif']").parent().css({"position":"absolute","left":"50%"});
        },300);
    });

    function loginbox(){
        var $logpop=$("#pop_win");
        $logpop.html('<iframe src="https://passport.csdn.net/account/loginbox?service=http://static.blog.csdn.net/callback.htm" frameborder="0" height="600" width="400" scrolling="no"></iframe>');

        $('#popup_mask').css({
            opacity: 0.5,
            width: $( document ).width() + 'px',
            height:  $( document ).height() + 'px'
        });
        $('#popup_mask').css("display","block");
 
        $logpop.css( {
            top: ($( window ).height() - $logpop.height())/ 2  + $( window 
       ).scrollTop() + 'px',
            left:($( window ).width() - $logpop.width())/ 2
        } );
 
        setTimeout( function () {
            $logpop.show();
            $logpop.css( {
                opacity: 1
            } );
        }, 200 );
 
        $('#popup_mask').unbind("click");
        $('#popup_mask').bind("click", function(){
            $('#popup_mask').hide();
            var $clopop = $("#pop_win");
            $("#common_ask_div_sc").css("display","none");
            $clopop.css( {
                opacity: 0
            } );
            setTimeout( function () {
                $clopop.hide();
            }, 350 );
            return false;
        });
    }   

    var articletitle='扩展GDAL，支持CNSDTF格式（一）';

</script>








                        <div class="clear">
                        </div>
                    </div>                   
                
            </div>
                   
           <div id="side">
               
    <div class="side">
<div id="panel_Profile" class="panel">
<ul class="panel_head"><span>个人资料</span></ul>
<ul class="panel_body profile">
<div id="blog_userface">
    <a href="http://my.csdn.net/liminlu0314" target="_blank">
    <img src="http://avatar.csdn.net/7/0/7/1_liminlu0314.jpg" title="访问我的空间" style="max-width:90%"/>
    </a>
    <br />
    <span><a href="http://my.csdn.net/liminlu0314" class="user_name" target="_blank">liminlu0314</a></span>
</div>
<div class="interact">

    <a href="javascript:void(0);" class="attent" id="span_add_follow" title="[加关注]"></a>

 <a href="javascript:void(0);" class="letter"  title="[发私信]" onclick="window.open('http://msg.csdn.net/letters/model?receiver=liminlu0314','_blank','height=350,width=700');_gaq.push(['_trackEvent','function', 'onclick', 'blog_articles_sixin'])"></a>  
</div>
<div id="blog_medal">
                       <div class="ico_expert"  onclick="javascript:location='http://blog.csdn.net/experts/rule.html'" title="CSDN认证专家" style="cursor:pointer;width:60px;height:60px;background:url('http://c.csdnimg.cn/jifen/images/xunzhang/xunzhang/bokezhuanjiamiddle.png') no-repeat" ></div>
                <div id="bms_box">
                                            <a  target="_blank">
                                                    <img src="http://c.csdnimg.cn/jifen/images/xunzhang/xunzhang/zhuanlandaren.png" onmouseover="m_over_m(this,2)" onmouseout="m_out_m()" alt="2" >
                                            </a>
                                            <a  target="_blank">
                                                    <img src="http://c.csdnimg.cn/jifen/images/xunzhang/xunzhang/chizhiyiheng.png" onmouseover="m_over_m(this,4)" onmouseout="m_out_m()" alt="1" >
                                            </a>
               </div>
</div>
<ul id="blog_rank">
    <li>访问：<span>847198次</span></li>
    <li>积分：<span>10752</span> </li>    
    <li >等级： <span style="position:relative;display:inline-block;z-index:1" >
            <img src="http://c.csdnimg.cn/jifen/images/xunzhang/jianzhang/blog7.png" alt="" style="vertical-align: middle;" id="leveImg">
            <div id="smallTittle" style=" position: absolute;  left: -24px;  top: 25px;  text-align: center;  width: 101px;  height: 32px;  background-color: #fff;  line-height: 32px;  border: 2px #DDDDDD solid;  box-shadow: 0px 2px 2px rgba (0,0,0,0.1);  display: none;   z-index: 999;">
            <div style="left: 42%;  top: -8px;  position: absolute;  width: 0;  height: 0;  border-left: 10px solid transparent;  border-right: 10px solid transparent;  border-bottom: 8px solid #EAEAEA;"></div>
            积分：10752 </div>
        </span>  </li>
    <li>排名：<span>第1371名</span></li>
</ul>
<ul id="blog_statistics">
    <li>原创：<span>148篇</span></li>
    <li>转载：<span>10篇</span></li>
    <li>译文：<span>7篇</span></li>
    <li>评论：<span>2263条</span></li>
</ul>
</ul>
</div>




<div id="custom_column_22424352" class="panel">
<ul class="panel_head"><span>新浪微博</span></ul>
<ul class="panel_body">
<iframe width="100%" height="550" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&amp;width=0&amp;height=550&amp;fansRow=1&amp;ptype=1&amp;speed=0&amp;skin=9&amp;isTitle=1&amp;noborder=1&amp;isWeibo=1&amp;isFans=1&amp;uid=2259303643&amp;verifier=cd1db22b&amp;dpc=1"></iframe>
</ul>
</div><div class="panel" id="panel_Search">
    <ul class="panel_head"><span>文章搜索</span></ul>
    <ul class="panel_body" class="form_search">
        <form id="frmSearch" action="http://so.csdn.net/search" class="form_search csdn-tracking-statistics" target="_blank"  data-mod="popu_306">
        <span><input id="inputSearch" type="text" class="blogsearch" title="请输入关键字" /></span>
        <input id="btnSubmit" type="button" value="搜索" title="search in blog" />
        <input type="hidden" name="q" id="inputQ" />
        <input type="hidden" name="t" value="blog" />
        <a id="btnSearchBlog" target="_blank"></a>
        </form>
    </ul>
</div>

<script type="text/javascript">

   
    $(function () {
        $("#btnSubmit").unbind("click");
        $("#btnSubmit").click(function () {           
            search();
        });

        $("#frmSearch").submit(function () {           
            search();
            return false;
        });

        function search()
        {
            if ($("#inputSearch").val() == "") {               
                alert("请录入搜索关键词！");                         
                return false;
            }
            //var url = "http://so.csdn.net/so/search/s.do?q=" + encodeURIComponent($("#inputSearch").val()) + "&u=" + username + "&t=blog";           
            var url = "https://www.baidu.com/s?wd=" + encodeURIComponent($("#inputSearch").val()) + "%20site%3Ablog.csdn.net"
            window.location.href = url;
        }   
    });
</script><div id="panel_Category" class="panel">
    <ul class="panel_head"><span>博客专栏</span></ul>
    <ul class="panel_body" id="sp_column">
    <table cellpadding="0" cellspacing="0"><tr>
    <td style="padding:10px 10px 0 0;">
    <a href="http://blog.csdn.net/column/details/gdal.html" target="_blank"><img src="http://img.blog.csdn.net/20151123174948192" style="width:75px;height:75px;" /></a>
    </td>
    <td style="padding:10px 0; vertical-align:top;">
    <a href="http://blog.csdn.net/column/details/gdal.html" target="_blank">GDAL交流</a>
    <p>文章：121篇</p>
    <span>阅读：654841</span>
    </td>
    </tr></table>
    </ul>
</div><div id="newcomments" class="panel">
<ul class="panel_head"><span>最新评论</span></ul>
<ul class="panel_body itemlist">
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/liminlu0314" class="user_name">liminlu0314</a>:
@qq_21472607:这种情况是不是你处理的时候分块的问题？你用gdalwarp测试了吗
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
@liminlu0314:感谢李老师的回复，传递参数的顺序，我根据6参数，传递200 1 0 -10...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
@liminlu0314:感谢李老师的回复，传递参数的顺序，我根据6参数，传递200 1 0 -10...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
@liminlu0314:感谢李老师的回复，传递参数的顺序，我根据6参数，传递200 1 0 -10...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/liminlu0314" class="user_name">liminlu0314</a>:
@qq_21472607:代码都是一样的，你注意你传递的参数顺序是不是对的？
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
李老师您好，我修改了最新的gdal202版本的GDALRPCTransform()函数，代码贴上了，...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
李老师您好，我试着修改了最新的gdal202版本的alg文件夹里面的gdal_rpc.cpp中的GD...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/24810593#comments">修改GDAL库支持RPC像方改正模型</a>
    <p style="margin:0px;"><a href="/qq_21472607" class="user_name">qq_21472607</a>:
RPCTransformPoint( psTransform, padfX, padfY,     ...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/7753377#comments">使用GDAL打开裸数据（RAW）</a>
    <p style="margin:0px;"><a href="/liminlu0314" class="user_name">liminlu0314</a>:
@sunnyloves:文件大小和平台没关系，和磁盘格式有关系，现在都是NTFS的磁盘，肯定支持大于...
    </p>
    </li>
    <li>
   
         <a href="/liminlu0314/article/details/7753377#comments">使用GDAL打开裸数据（RAW）</a>
    <p style="margin:0px;"><a href="/sunnyloves" class="user_name">sunnyloves</a>:
@liminlu0314:多谢！是不规则的，矩形区域里只有一部分有高程数据，其他没高程的是不是要填入...
    </p>
    </li>
</ul>
</div>
<div id="panel_Archive" class="panel">
<ul class="panel_head"><span>文章存档</span></ul>
<ul class="panel_body">
<div id="archive_list">
<!--归档统计-->
<li><a href="/liminlu0314/article/month/2017/03">2017年03月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2017/02">2017年02月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2017/01">2017年01月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2016/12">2016年12月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2016/08">2016年08月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2016/04">2016年04月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2016/03">2016年03月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2015/12">2015年12月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2015/11">2015年11月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2015/09">2015年09月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2015/07">2015年07月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2015/03">2015年03月</a><span>(4)</span></li><li><a href="/liminlu0314/article/month/2015/01">2015年01月</a><span>(4)</span></li><li><a href="/liminlu0314/article/month/2014/11">2014年11月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2014/10">2014年10月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2014/09">2014年09月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2014/07">2014年07月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2014/05">2014年05月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2014/04">2014年04月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2014/03">2014年03月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2014/02">2014年02月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2014/01">2014年01月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2013/12">2013年12月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2013/11">2013年11月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2013/10">2013年10月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2013/09">2013年09月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2013/08">2013年08月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2013/07">2013年07月</a><span>(4)</span></li><li><a href="/liminlu0314/article/month/2013/06">2013年06月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2013/05">2013年05月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2013/04">2013年04月</a><span>(11)</span></li><li><a href="/liminlu0314/article/month/2013/03">2013年03月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2013/02">2013年02月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2013/01">2013年01月</a><span>(14)</span></li><li><a href="/liminlu0314/article/month/2012/12">2012年12月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2012/11">2012年11月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2012/10">2012年10月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2012/09">2012年09月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2012/08">2012年08月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2012/07">2012年07月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2012/06">2012年06月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2012/05">2012年05月</a><span>(7)</span></li><li><a href="/liminlu0314/article/month/2012/04">2012年04月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2012/03">2012年03月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2012/02">2012年02月</a><span>(3)</span></li><li><a href="/liminlu0314/article/month/2012/01">2012年01月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2011/12">2011年12月</a><span>(4)</span></li><li><a href="/liminlu0314/article/month/2011/11">2011年11月</a><span>(4)</span></li><li><a href="/liminlu0314/article/month/2011/10">2011年10月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2011/07">2011年07月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2011/03">2011年03月</a><span>(2)</span></li><li><a href="/liminlu0314/article/month/2011/02">2011年02月</a><span>(5)</span></li><li><a href="/liminlu0314/article/month/2011/01">2011年01月</a><span>(9)</span></li><li><a href="/liminlu0314/article/month/2010/12">2010年12月</a><span>(1)</span></li><li><a href="/liminlu0314/article/month/2010/11">2010年11月</a><span>(1)</span></li>
</div>
</ul>
</div>
<div id="hotarticls2" class="panel">
<ul class="panel_head"><span>评论排行</span></ul>
<ul class="panel_body itemlist">
<li>
<a href="/liminlu0314/article/details/6937194" title="GDAL源码剖析（二）之编译说明">GDAL源码剖析（二）之编译说明</a><span>(165)</span>
</li>
<li>
<a href="/liminlu0314/article/details/7072224" title="GDAL源码剖析（七）之GDAL RasterIO使用说明">GDAL源码剖析（七）之GDAL RasterIO使用说明</a><span>(158)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6136512" title="如何使用GDAL进行AOI裁剪">如何使用GDAL进行AOI裁剪</a><span>(99)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6127755" title="使用GDAL创建Erdas格式的金字塔">使用GDAL创建Erdas格式的金字塔</a><span>(95)</span>
</li>
<li>
<a href="/liminlu0314/article/details/17400075" title="QGIS编译">QGIS编译</a><span>(79)</span>
</li>
<li>
<a href="/liminlu0314/article/details/7072007" title="GDAL源码剖析（六）之GDAL开发及其调试">GDAL源码剖析（六）之GDAL开发及其调试</a><span>(72)</span>
</li>
<li>
<a href="/liminlu0314/article/details/7753377" title="使用GDAL打开裸数据（RAW）">使用GDAL打开裸数据（RAW）</a><span>(65)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6130064" title="如何使用GDAL重采样图像">如何使用GDAL重采样图像</a><span>(63)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6144833" title="编写PhotoShop支持遥感图像数据">编写PhotoShop支持遥感图像数据</a><span>(60)</span>
</li>
<li>
<a href="/liminlu0314/article/details/7613894" title="使用RasterIO快速显示图像">使用RasterIO快速显示图像</a><span>(60)</span>
</li>
</ul>
</div>
<div id="hotarticls" class="panel">
<ul class="panel_head">
    <span>       
阅读排行    </span>
</ul>

<ul class="panel_body itemlist">
<li>
<a href="/liminlu0314/article/details/7072224" title="GDAL源码剖析（七）之GDAL RasterIO使用说明">GDAL源码剖析（七）之GDAL RasterIO使用说明</a><span>(30953)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6937194" title="GDAL源码剖析（二）之编译说明">GDAL源码剖析（二）之编译说明</a><span>(28591)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6933772" title="GDAL源码剖析（一）">GDAL源码剖析（一）</a><span>(26303)</span>
</li>
<li>
<a href="/liminlu0314/article/details/8553926" title="关于已知两点经纬度求球面最短距离的公式推导">关于已知两点经纬度求球面最短距离的公式推导</a><span>(24703)</span>
</li>
<li>
<a href="/liminlu0314/article/details/7072007" title="GDAL源码剖析（六）之GDAL开发及其调试">GDAL源码剖析（六）之GDAL开发及其调试</a><span>(16084)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6945452" title="GDAL源码剖析（三）之Swig编译和帮助文档生成">GDAL源码剖析（三）之Swig编译和帮助文档生成</a><span>(15080)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6130064" title="如何使用GDAL重采样图像">如何使用GDAL重采样图像</a><span>(14962)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6127755" title="使用GDAL创建Erdas格式的金字塔">使用GDAL创建Erdas格式的金字塔</a><span>(14651)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6978589" title="GDAL源码剖析（四）之命令行程序说明一">GDAL源码剖析（四）之命令行程序说明一</a><span>(12728)</span>
</li>
<li>
<a href="/liminlu0314/article/details/6136512" title="如何使用GDAL进行AOI裁剪">如何使用GDAL进行AOI裁剪</a><span>(12230)</span>
</li>
</ul>
</div>
    </div>
    <div class="clear">
    </div>


                   <!-- 广告位开始 -->                    <!-- 广告位结束 -->
                   <div class="tracking-ad" data-view="true"  data-mtp="63" data-order="40" data-con="ad_content_1260" style="width: 200px; height: 200px;">
                         <div id="nav_show_top_stop" style="width: 200px;height: 200px;z-index:1000"><div id="cpro_u2734128"></div></div>
                   </div>
    <script type="text/javascript">    
        setTimeout(function () {
            var naviga_offsetTop = 0;
            function naviga_stay_top() { var scrollTop = jQuery(document).scrollTop(); if (scrollTop > naviga_offsetTop) { jQuery("#nav_show_top_stop").css({ "position": "fixed" }); jQuery("#nav_show_top_stop").css({ "top": "0px" }); } else { jQuery("#nav_show_top_stop").css({ "position": "fixed" }); jQuery("#nav_show_top_stop").css({ "top": naviga_offsetTop - scrollTop + "px" }); } }
            function onload_function() { naviga_offsetTop = jQuery("#nav_show_top_stop").position().top; jQuery(window).bind("scroll", naviga_stay_top); jQuery(window).bind("mousewheel", naviga_stay_top); jQuery(document).bind("scroll", naviga_stay_top); jQuery(document).bind("mousewheel", naviga_stay_top); } jQuery(document).ready(onload_function);
               
        }, 200);    
    </script>
<script type="text/javascript">(window.cproArray = window.cproArray || []).push({ id: "u2734128" });  </script> 
                    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script> 

           </div>   

            <div class="clear">
            </div>
        </div>

        








    <script type="text/javascript" src="http://passport.csdn.net/content/loginbox/login.js"></script>
<script type="text/javascript">
    $(function () {
        function __get_code_toolbar(snippet_id) {
            return $("<span class='tracking-ad' data-mod='popu_167'><a href='https://code.csdn.net/snippets/"
                    + snippet_id
                    + "' target='_blank' title='在CODE上查看代码片'  style='text-indent:0;'><img src='https://code.csdn.net/assets/CODE_ico.png' width=12 height=12 alt='在CODE上查看代码片' style='position:relative;top:1px;left:2px;'/></a></span>"
                    + "<span class='tracking-ad' data-mod='popu_170'><a href='https://code.csdn.net/snippets/"
                    + snippet_id
                    + "/fork' target='_blank' title='派生到我的代码片' style='text-indent:0;'><img src='https://code.csdn.net/assets/ico_fork.svg' width=12 height=12 alt='派生到我的代码片' style='position:relative;top:2px;left:2px;'/></a></span>");
        }
        
        $("[code_snippet_id]").each(function () {
            __s_id = $(this).attr("code_snippet_id");
            if (__s_id != null && __s_id != "" && __s_id != 0 && parseInt(__s_id) > 70020) {
                __code_tool = __get_code_toolbar(__s_id);
                $(this).prev().find(".tools").append(__code_tool);
            }
        });

        $(".bar").show();
    });
</script>





    </div>
      <!--new top-->
    

     

   
        <!--new top-->
   
   

    
    
    
   

   


       <script type="text/javascript" src="http://static.blog.csdn.net/public/res/bower-libs/MathJax/MathJax.js?config=TeX-AMS_HTML"></script>
          <script type="text/javascript">
              //$(function () {
              //    setTimeout(function () {
              //        var searchtitletags = articletitle + ',' + $("#tags").html();
              //        searchService({
              //            index: 'blog',
              //            query: searchtitletags,
              //            from: 5,
              //            size: 5,
              //            appendTo: '#res',
              //            url: 'recommend',
              //            his: 2,
              //            client: "blog_cf_enhance",
              //            tmpl: '<dd style="background:url(http://static.blog.csdn.net/skin/default/images/blog-dot-red3.gif) no-repeat 0 10px;"><a href="#{ url }" title="#{ title }" strategy="#{ strategy }">#{ title }</a></dd>'
              //        });
              //    }, 1000);
              //});

         </script>
    
    <script src="http://static.blog.csdn.net/scripts/csdn_blog_detail.min.js" type="text/javascript"></script>
        
    <script type="text/javascript" src="http://c.csdnimg.cn/blog/csdn_public_blog_detail.min.js?20170606001"></script>

    <script type="text/javascript" src="http://medal.blog.csdn.net/showblogmedal.ashx?blogid=581090"></script>

     
    


  <div id="a52b5334d" style="width: 1px; height: 1px; display: none;">
                    <script id="adJs52b5334"></script>
                    <script>document.getElementById("adJs52b5334").src = "http://ads.csdn.net/js/opt/52b5334.js?t=" + Math.random();</script>
   </div>

    
    
        
     

    
          
    <div class="pop_CA_cover"  style="display:none"></div>
    <div class="pop pop_CA"  style="display:none">
          <div class="CA_header">
            收藏助手
            <span class="cancel_icon"  id="fapancle"  onclick="$('.pop_CA').hide();$('.pop_CA_cover').hide();"></span>
          </div>
          <iframe src="" id="fa" frameborder="0" width="100%" height="360"  scrolling="no" ></iframe>
    </div>


        <script type="text/javascript">

            $(function () {
                var fromjs = $("#fromjs");
                if (fromjs.length > 0) {
                    $("#fromjs .markdown_views pre").addClass("prettyprint");
                    prettyPrint();

                    $('pre.prettyprint code').each(function () {
                        var lines = $(this).text().split('\n').length;
                        var $numbering = $('<ul/>').addClass('pre-numbering').hide();
                        $(this).addClass('has-numbering').parent().append($numbering);
                        for (i = 1; i <= lines; i++) {
                            $numbering.append($('<li/>').text(i));
                        };
                        $numbering.fadeIn(1700);
                    });

                    $('.pre-numbering li').css("color", "#999");
                }
            });
           
            $(".markdown_views a[target!='_blank']").attr("target", "_blank");

            $(".toc a[target='_blank']").attr("target", "");

        </script>

</body>
</html>   
 